%%%% ANNOTATIONS BY AUTHORS %%%%%%%
\newcommand{\toby}[1]{#1} %{\switchcolor{purple}{#1}}
\newcommand{\tobym}[1]{\textcolor{purple}{#1}}
\newcommand{\sdJ}[1]{#1}%{{\color{blue}{#1}}}
\newcommand{\sdO}[1]{{\color{red}{#1}}}
\newcommand{\sdJJ}[1]{{\color{red}{#1}}}
\newcommand{\sd}[1]{#1} %{{\color{blue}{#1}}}
\newcommand{\scd}[1]{{\switchcolor{blue}{#1}}}
\newcommand{\jn}[1]{{\switchcolor{dkgreen}{#1}}}
\newcommand{\kjx}[1]{{\switchcolor{dkgreen}{#1}}}
\newcommand{\jnc}[1]{{\switchcolor{purple}{#1}}}
\newcommand{\jnCUT}[1]{{}}
\newcommand{\footnoteC}[1]{} % {\footnote{#1}} To hode internal comments
\newcommand{\sdCut}[2]{}%  {\footnote{{\color{red}{Sophia removed the following:\ }}{#1}{\color{red}{Sophia's reason:\ }}{#2}}}




%{
\newcommand{\VDash}{%
\, |\!\!\models
}



\renewcommand{\prg}[1]{{\ensuremath{\textrm{\ttfamily{#1}}}}} %KJX no \footnotesize math
% SD remived the \small
%{{\ensuremath{\textrm{\ttfamily\small{#1}}}}} %KJX no \footnotesize math
%\renewcommand{\prg}[1]{{\ensuremath{\tt{#1}}}} %KJX no \footnotesize math
% \newcommand{\prgA}[1]{{\lstinline+{#1}+}} %{\ensuremath{\footnotesize\tt{#1}}}}

\newcommand{\interp}[2]{{\ensuremath{\lfloor{ {#1}}\rfloor_{#2}}}}
\newcommand{\interpp}[2]{{\ensuremath{|\!\lfloor{#1}\rfloor\!|_{#2}}}}
\newcommand{\interpps}[2]{{\ensuremath
{\, {#2} \VDash {#1}}}}
\newcommand{\appref}[1]{{\it c.f.} App. \ref{#1}}
\renewcommand{\etc}{{\it e.t.c.}}


\newcommand{\LangOO} {\ensuremath{\cal F}\textit{ocal}}
\newcommand{\Chainmail} {\ensuremath{\cal C}\textit{hainmail}}

\newcommand{\vspaceSD}{} % vspace{-0.1in}

% ------------------------------------------------------------------
%                                             positions, separations
\newcommand{\SPACES}{~\SP\SP}
\newcommand{\p}{r}
\newcommand{\pushright}{\hfill}
\newcommand{\spaceS}{  } % \SP \SP \SP \SP \SP \SP}
\newcommand{\spacesS}{~\spaceS}
\newcommand{\bullA}{}
\newcommand{\prgTabs}{1234567\=89012345\=678\=901234567890123\=456789\=01234\kill}
\newcommand{\cf}{{\it c.f.~}}
\newcommand{\HYPHENA}{{\em-- }}
\newcommand{\HYPHENB}{{\em-- }}
\newcommand{\SP}{{\ensuremath{ ~ }} {\hspace{.1in}}}
\newcommand{\VSP}{{\vspace{0.1in}}}
\newcommand{\SPLarge}{{\hspace{.3in}}}
\newcommand{\SPHuge}{{\hspace{0.8in}}}
\newcommand{\s}{{\hspace{.05in} }}
\newcommand{\SPsmall}{{\hspace{.1in}}}

%------------------------ syntax tables

\newcommand{\syntax}[1]{{#1}} % {\textit{#1}}
\newcommand{\BBC}{$::=$} %in syntactic definitions
\newcommand{\SOR}{\ensuremath{\ \mid\ }} % BNF or
\newcommand{\MID}{{\SPsmall ~ \mid ~ \SPsmall }} % in sets


% ------------------------------------------------------------------
%                                             English abbreviations

% ------------------------------------------------------------------
%                                              keywords, program text
\newcommand{\kw}[1]{{\bf {#1}}}
%{\mbox{\prgCol{\rm{\bf {#1}}}}}
\newcommand{\lit}[1]{{\prg {#1}\xspace}}
\newcommand{\com}{\ensuremath{\prg{//}}}
\renewcommand{\p}{\ensuremath{\prg{p}}}

\newcommand{\ext}{\mbox{\,\,{\kw {extends}}\,\,}}
\newcommand{\extends}{\mbox{\,\,{\kw {extends}}\,\,}}
\newcommand{\ass}{\mbox{{\kw {:=}}\,}}
\newcommand{\semi}{\mbox{{\kw {;}}\ }}
\newcommand{\comma}{\mbox{{\kw {,}}\,}}
\newcommand{\dotK}{\mbox{{\kw {.}}}}
\newcommand{\class}{\mbox{{\kw {class}}\,\,}}
\newcommand{\stat}{\mbox{{\kw {state}}}}
\newcommand{\trans}{\mbox{{\kw {root}}}}
            % {\mbox{{\kw {root state}}}}
            % was {\mbox{{\kw {abs-state}}}}
\newcommand{\lb}{\mbox{\tt{\bf{\{ }}}}
\newcommand{\rb}{{\mbox{\tt{\bf{\} }}}}}
\newcommand{\lp}{{\mbox{\tt{\bf{( }}}}}
\newcommand{\rp}{\mbox{\tt{\bf{) }}}}
\newcommand{\abstractM}{\kw {abstract}}
\newcommand{\throws}{\rm\bf throws}
\newcommand{\throw}{\rm\bf throw}
\newcommand{\IF}{{\kw {if}}\s}
\newcommand{\abstr}{{\kw {abstract}}\s}
\newcommand{\for}{{\kw {for}}\s}
\newcommand{\retKW}{{\kw {return}}\s}
\newcommand{\THEN}{\s{\kw {then}}\s}
\newcommand{\ELSE}{\s{\kw {else}}\s}
\newcommand{\this}{{\kw {this}}}
\newcommand{\x}{{\kw {x}}}
\newcommand{\nullK}{{\lit {null}}}% no~around it
\newcommand{\thisL}{{\lit {this}}}% no~around it
\newcommand{\nullKW}{{\lit {null}}~}
\newcommand{\true}{{\lit {true}}~}
\newcommand{\trueK}{{\prg {true}}}
\newcommand{\false}{{\lit {false}}~}
\newcommand{\falseK}{{\prg {false}}}
\newcommand{\return}{{\kw {return}}\s}

\newcommand{\implKW}{\s{\kw {impl}}\s}
\newcommand{\defs}{{\it defs}}



\newcommand{\Prog}[1]  {{\ensuremath{\prg{M}{{\prg{#1}}}}}}
 \newcommand{\clss}[1]{\ensuremath{\prg{c}{\prg{#1}}}}
\newcommand{\val}[1]{{\ensuremath{\prg{v}{\prgCol{#1}}}}}
\newcommand{\res}[1]{{\ensuremath{\prg{dv}{#1}}}}




% structuring macros
\newcommand{\EndDefLemma}{\noindent $\bigtriangleup$}



%\newcommand{\para}[1]{{\ensuremath{\prg{x}{#1}}}}

\newcommand{\EMPTY}{\ \ } % fools the substack
\newcommand{\modelsWithO}%
{\models\!\!\!\!{_{_{_{\tiny{\cal O}}}}}}
\newcommand{\modelsWithOQ}{\models\!\!\!\!?{_{_{_{\tiny{\cal O}}}}}}
\newcommand{\modelsWith} [1]{\models\!\!\!\!{_{_{_{\tiny{#1}}}}}}
% {\underset{^{\cal O}}{\models}}
%{\stackrel{\mathclap{\normalfont\mbox{def}}}{=}}


%-------------------- implies, and, or, iff, etc -----------------
\newcommand{\inset}[3]{\prg{#1}\!\in\!\prg{#2},\ldots,\prg{#3}}
% do not change above, it is also used with \forall, \exists

\newcommand{\IFF}{{\SP {\mbox{ iff }} \SP}}

\newcommand{\OR}{{\SPsmall {\mbox{or}} \SPsmall}}
\newcommand{\upd}{{\mapsto}}



%%%%%%%%%%%%%%%%%%%%% %Macros for inference rules  %%%%%%%%%%%%%%%%%%%%%%%
%%% all needed %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\ruleN}[1]{\mbox{({\sc{#1}})}}

\newcommand{\inferencerule}[2]{
\begin{array}{l} #1 \\ \hline #2 \end{array}
}
%
\newcommand{\inferenceruleB}[4]
{
\begin{array}{l}
{#1} {\ruleN {#2}}
\\ #3  \\ \hline   #4
  \end{array}
}
\newcommand{\inferenceruleN}[3]
{
\begin{array}{l}
% \SP\SP\SP\SP\SP\SP\SP\SP
% \SP\SP\SP\SP\SP\SP\SP\SP
\SP\SP\SP\SP\SP\SP\SP\SP
\SP\SP\SP\SP\SP\SP  {\ruleN {#1}}
\\ #2  \\ \hline   #3
  \end{array}
}

\newcommand{\inferenceruleNP}[3]
{
\begin{array}{l}
% \SP\SP\SP\SP\SP\SP\SP\SP
% \SP\SP\SP\SP\SP\SP\SP\SP
\SP\SP\SP\SP\SP\SP  {\ruleN {#1}}
\\ #2  \\ \hline   #3
  \end{array}
}
%
\newcommand{\inferenceruleNN}[3]
{
\begin{array}{l}
\hspace{5in}
   {\ruleN {#1}}
\\ #2  \\ \hline   #3
  \end{array}
}
%
\newcommand{\inferenceruleNNP}[3]
{
\begin{array}{l}
\hspace{3.5in}
   {\ruleN {#1}}
\\ #2  \\ \hline   #3
  \end{array}
}

%===========================================================================
%  Definition-Lemma-Theorem-Proof
%
% Adaptation of LaTeX's theorem environment; can be used as a command
% (eg just \Lemma not \begin{Lemma}) and no italicisation; also works
% with ptmac; result numbering is uniform within subsections and can be
% suppressed.
%
\newif\ifNumberResults\NumberResultstrue
\def\@@opargbegintheorem#1#2#3{\@@@@begintheorem{\bf\@@thmname{#1}{#2}(#3)}}
\def\@@begintheorem#1#2{\@@@@begintheorem{\bf\@@thmname{#1}{#2}}}
\def\@@@@begintheorem#1{\par\removelastskip\smallskip\noindent{#1}}
\def\@@thmname#1#2{#1\ \ifNumberResults#2\ \fi}

% similarly \Proof or \begin{Proof}...\end{Proof}
% prefer proofs with statements if possible - hence \penalty700
%\let\qedsymbol\S% make it \square or \blacksquare if you like for kb
\let\qedsymbol \Box
\def\qed{\pushright{$\qedsymbol$}}
\def\Proof{\par\removelastskip\smallskip\penalty700\noindent{\bf Proof}\enskip}
\def\endProof{\qed\penalty-700 \smallskip}
\let\endproof\endProof

\newcommand{\z}{{\prg z}}
\newcommand{\Meths}[3]{\ensuremath{{\cal M}(}\Prog{#1},\prg{#2},
\prg{#3}\ensuremath{)} }




%
%
%
\newcommand{\addr}[1]{{\prg{\mbox{$\iota$}}}}


\newcommand{\rewriteLong}[1]
{\ensuremath{\ \leadsto\!\!\!\!\!\!_{_{#1}\,\ \ }}}
\newcommand{\rewrite}[1]
{\ensuremath{\ \leadsto\!\!\!\!\!\!_{_{\Prog{#1}}\,\ \ }}}



\newcommand{\syntaxClass}{\syntax{c} }%{\ensuremath{\syntax{c}}}
\newcommand{\syntaxField}{\syntax{f} }% {\ensuremath{\syntax{f} }}
\newcommand{\syntaxMeth}{\syntax{m} }% {\ensuremath{\syntax{m} }}
\newcommand{\syntaxParam}{\syntax{p} }% {\ensuremath{\syntax{p}}}
\newcommand{\syntaxexp}{\syntax{e} }% {\ensuremath{\syntax{e}}}


\newcommand{\pre}{\ensuremath{_{{pre}}}}   %kjx no \sc  in math mode
\newcommand{\post}{\ensuremath{_{{post}}}} %kjx no \sc  in math mode
\newcommand{\PRE}{\pre}
\newcommand{\POST}{\post}

\newcommand{\obeys}{\,\textbf{\textrm{obeys}}\,}
\newcommand{\uses}{\,\textbf{\textrm{uses}}\,}
\newcommand{\usestr}{\,\textbf{\textrm{uses}}^*\,}
\newcommand{\asPredicate}[1]{\textrm{{\it {#1}}}}
\newcommand{\Muses}[2]{{\asPredicate{Uses}}({#1},{#2})}
\newcommand{\Mimpls}[2]{{\asPredicate{Impls}}({#1},{#2})}
\newcommand{\Closed}[1]{{\asPredicate{Closed}}({#1})}
\newcommand{\Stratified}[1]{{\asPredicate{Stratified}}({#1})}
\newcommand{\Classes}[1]{{\asPredicate{Classes}}({#1})}
\newcommand{\Policies}[1]{{\asPredicate{Policies}}({#1})}
\newcommand{\Private}[2]{{\asPredicate{Private}}({#1},{#2})}
\newcommand{\Creates}[2]{{\asPredicate{Creates}}({#1},{#2})}

\newcommand{\lvar}{\ensuremath{\mathfrak{var}}}
\renewcommand{\val}{\ensuremath{{val}}}
\newcommand{\Lvars}{\ensuremath{\mathfrak{L}vars}}

\newcommand{\Pol}[1]{{\bf{Pol\_Prs}}\_{#1}}

%% functions
\newcommand{\MayAffect}{\ensuremath{\mathcal{M}\textrm{\textit{ay}}{\mathcal{A}}\textrm{\textit{ffect}}}}
\newcommand{\MayRead}{\ensuremath{\mathcal{M}\textrm{\textit{ay}}{\mathcal{R}}\textrm{\textit{ead}}}}
\newcommand{\MayAccess}{\ensuremath{\mathcal{M}\textrm{\textit{ay}}{\mathcal{A}}\textrm{\textit{ccess}}}}
\newcommand{\PassedValue}{\ensuremath{\mathcal{P}\textrm{\textit{assed}}{\mathcal{V}}\textrm{\textit{alue}}}}
\newcommand{\MayPublicAccess}{{\mathcal{M}}\textit{ay}{\mathcal{A}}\textit{ccess}{\mathcal{P}}\textit{ub}}
\newcommand{\New}{{\mathcal{N}}\!\textrm{\textit{ew}}}
\newcommand{\Arising}{{\mathcal{A}}\textrm{\textit{rising}}}
\newcommand{\Accessible}{{\mathcal{A}}\textit{ccessible}}
\newcommand{\AccPub}{{\mathcal{A}}\textit{cc}{\mathcal{P}}\textit{ub}}
\newcommand{\AccAll}{{\mathcal{A}}\textit{cc}{\mathcal{A}}\textit{ll}}
\newcommand{\Used}{{\mathcal{U}}\textit{sed}}
\newcommand{\Reach}{{\mathcal{R}each}}
%% sets
\newcommand{\Policy}{{\textit{Policy}}}
\newcommand{\PolicySpec}{{\textit{PolicySpec}}}
\newcommand{\PolSpecId}{{\textit{PolSpecId}}}
\newcommand{\ParId}{{\textit{PId}}}
\newcommand{\ClassId}{{\textit{ClassId}}}

%% Hoare Logic
%% with the module parameter implicitly given
\newcommand{\HoareCSep}% the separator for the conclusion
{\Join}
\newcommand{\Hoare}[4]
{{\ensuremath{\vdash  \,{#1}\,  \{\, {#2}\, \}\  {#3}\ \HoareCSep\  {#4} }}}
\renewcommand{\O} % the oracle
{{\ensuremath{\cal O}}}
\newcommand{\withO} % the oracle
{{\ensuremath{\!\!\!_{_{\O}}\,}}}

\newcommand{\HoareSP}{~ \SP\SP\SP}
\newcommand{\HoareNLSP}[5]
{\ensuremath{\begin{array}{ccl}
\SP\SP \ruleN{#1}
& \SP &
\begin{array}{l} #2 \\  \SP\SP \{\   #3  \} \\  #4 \\    \SP\SP   \HoareCSep\\    #5
\end{array}
\end{array}
}}
\newcommand{\HoareNL}[4]
{\ensuremath{\begin{array}{l}
   #1\\  ~ \SP  \{\   #2  \} \\  #3 \\      \HoareCSep\\   #4
  \end{array}
}}
\newcommand{\HoareImpl}[4]{{\ensuremath{ {#1}\  \{\, {#2}\, \}\  {#3}\ \HoareCSep\  {#4}  }}}
\newcommand{\HoareExpl}[5]{{\ensuremath{{#3}\vdash%_{#1} no longer needed!
{#1}\  \{\, {#2}\, \}\ {#4}\ \HoareCSep\ \  {#5}  }}}
\newcommand{\disj}{\,\#\,}
\newcommand{\ddisj}{\,\#\!\!\!\#\,}

\newcommand{\MP}{\prg{M}}
\newcommand{\CP}{\prg{C}}
\newcommand{\SPC}{\prg{S}}

 \newcommand{\switchcolor}[2]{{\textcolor{#1}{#2}}}


\newcommand{\M}{\ensuremath {M}} % {\textit{M}}
\renewcommand{\c}{\syntax{c}}
\newcommand{\f}{\syntax{f}}
%\renewcommand{\P}{\syntax{P}}
 \renewcommand{\code}{{\prg{stmts}}}
 \renewcommand{\t}{{\textit{t}}}
%\renewcommand{\P}{{P}}
%\newcommand{\Q}{{Q}}
\newcommand{\sExpr}{{Expr}}
\newcommand{\sE}{{\prg{e}}}

\newcommand{\A}{\ensuremath {A}}
\newcommand{\B}{\ensuremath {B}}
\renewcommand{\P}{\ensuremath {P}}

\newcommand{\Obj}{{\prg{Object}}}
\newcommand{\sprout}{{\prg{sprout}}}
\newcommand{\PS}{{\prg{ValidPurse}}}
\newcommand{\GP}{{\prg{GoodPrs}}}
\newcommand{\sM}{{\prg{sellerMoney}}}
\newcommand{\sG}{{\prg{sellerGoods}}}
\newcommand{\bM}{{\prg{buyerMoney}}}
\newcommand{\bG}{{\prg{buyerGoods}}}
\newcommand{\eM}{{\prg{escrowMoney}}}
\newcommand{\eG}{{\prg{escrowGoods}}}
\newcommand{\bal}{{\prg{balance}}}
\newcommand{\stmts}{{\prg{stmts}}}
\newcommand{\stmtss}{{\prg{s}}}
\renewcommand{\res}{{\prg{res}}}
\newcommand{\sMs}{{\prg{sM}}}
\newcommand{\sGs}{{\prg{sG}}}
\newcommand{\bMs}{{\prg{bM}}}
\newcommand{\bGs}{{\prg{bG}}}
\newcommand{\eMs}{{\prg{eM}}}
\newcommand{\eGs}{{\prg{eG}}}


%James thinks these are unnecessary, evil, and unnecessarily evil!
\newcommand{\paraA}[1]{\vspace*{-1ex}\paragraph{#1}}
\newcommand{\paraB}[1]{\noindent{{\bf{#1}}}}
\newcommand{\paraC}[1]{\subsection{#1}} % {\paragraph{#1}} %
\newcommand{\paraD}[1]{\subsection{#1}}


% FIXMEs you can't ignore
\newcommand{\FIXME}[1]{\textbf{\textsl{\colorbox{yellow}{FIXME:} #1}}}
