% Syntax highlighting for the Grace language
% Based on the syntax from the specification,
% modified by Michael Homer, Andrew Black.
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[T1]{fontenc}
\usepackage{textcomp} % for \textquotesingle, \textquotedbl, used by upquote=true
%\usepackage{lmodern} % to undo the bad effects of fontenc
\lstdefinelanguage{Grace}{
%   keywords={self,true,false,match,case,catch,raise,returns,
%        prefix,
%        super,outer,finally,using,extends,Selftype},
   morendkeywords={class,object,return,inherits,def,var,type,where,method,is,
   	super,outer,self,self type,prefix,import,as,dialect,trait,uses},
   sensitive,
   morecomment=[s]{/*}{*/},%
   morecomment=[l]{//},%
   morestring=[b]",%
   basicstyle=\sffamily\small,
   xleftmargin=1em,
   showstringspaces=false,
   keywordstyle=\color{black}\bfseries,
   ndkeywordstyle=\color{Mahogany}\bfseries,
   identifierstyle=\color{black},
   commentstyle=\color{BlueGrey}\rmfamily\itshape,
   stringstyle=\color{MidnightBlue}\ttfamily,
   aboveskip=0.6ex plus 1pt minus 1pt,
   belowskip=0.6ex plus 1pt minus 1pt,
   columns=flexible
}[keywords,comments,strings]

\newcommand{\grace}{
\lstset{language=Grace,
	keywordstyle=\color{black}\bfseries,
	mathescape=true,
	showstringspaces=false,
	keepspaces=true,
	breaklines=true,
	literate={+}{{$+$}}1 {-}{{$-$}}1,
	upquote=true,
	columns=fullflexible} % no fixed width fonts
}

\lstdefinelanguage{Smalltalk}{
%  morekeywords={self,super,true,false,nil,thisContext}, % This is overkill
  morestring=[d]',
  morecomment=[s]{"}{"},
  commentstyle=\color{RoyalBlue}\rmfamily\itshape,
  alsoletter={\#:},
  escapechar={!},
  literate=
    {BANG}{!}1
    {CARET}{\^}1
    {UNDERSCORE}{\_}1
    {\\st}{Smalltalk}9 % convenience -- in case \st occurs in code
    %{"}{{\textquotedbl}}1 
    {_}{{$\leftarrow$}}1
    {>>>}{{\sep}}1
    {^}{{$\uparrow$}}1
    {~}{{$\sim$}}1
    {-}{{\texttt{-}}}1 %{\textminus}}1 %{-}{\hspace{-0.13em}}{-}}1  % the goal is to make - the same width as +
    % {+}{\sf+}1 %{\raisebox{0.08ex}{+}}}1      % and to raise + off the baseline to match -
    {-->}{{\quad$\longrightarrow$\quad}}3
	, % Don't forget the comma at the end!
  tabsize=4
}[keywords,comments,strings]

%\newcommand{\sep}{\ensuremath{\small\gg}}
\newcommand{\sep}{\mbox{$>\!\!>$}}
\newcommand{\self}{\lct{self}\xspace}
\newcommand{\super}{\lct{super}\xspace}
\newcommand{\nil}{\lct{nil}\xspace}

\newcommand{\smalltalk}{
\lstset{language=Smalltalk,
	basicstyle=\sffamily,
	keywordstyle=\color{black}\bfseries,
	% stringstyle=\ttfamily, % Ugly! do we really want this? -- on
	mathescape=true,
	showstringspaces=false,
	keepspaces=true,
	breaklines=true,
	breakautoindent=true,
%	backgroundcolor=\color{source},
	lineskip={-1pt}, % Ugly hack
	upquote=true, % straight quote; requires textcomp package
	columns=fullflexible} % no fixed width fonts
}

\grace
\newcommand{\code}[1]{\lstinline{#1}}

