Here we will write examples of the codes. We denote though \prg{untrust.unkn(...)} the call to an untrusted (external) object.


\subsection{Something}

These  method s have no "story"; they serve  as warnings about things we should not take for grated.

\begin{lstlisting}[language=chainmail, mathescape=true, frame=lines]
class Account

     void warning( ) {
          p := new Password
          p' := new Password
          a := new Accoount.
          a.setPassword(null,p);
          untrust.unkn(a)
          this.password := p  /*  and in variant\_1 */     this.password := p' 
          return p    
     }
     
     void dare_you(){
          this.status := frozen    //  to transfer we need the account to be unfrozen 
          untrust.unkn(this.password)
          this.password:=new Password
          this.frozen := false
     }   // SD: hmhhh,  essentially we de-activated the account! We need 2.3.1!!!
     
...
\end{lstlisting}


\subsection*{Deactivate and leak old}

This method writes a new \prg{Passowrd} into the account, and thus essentially disables it. And it returns the old password.

\begin{lstlisting}[language=chainmail, mathescape=true, frame=lines]
class Account

     Password deacrtivate_and_leak_old( ) {
          p := this.password
          this.password := new Password
          return p    
     }
     
...
\end{lstlisting}

\subsection{Transfer with external}

This method  does half the job of  \prg{transfer}, then calls "outside", and then does the rest

\begin{lstlisting}[language=chainmail, mathescape=true, frame=lines]
class Account

     void transfer_2 (Password p, Account to, int amt) {
          if (p==this.password){
                  this.balance -= 2
                  to.balance += 2
                  untrust.unkn();
                  this.balance -= amt -2
                  to.balance += amt-2
                     
     }
     
...
\end{lstlisting}

\subsection{Bank may leak unused Passwords}
\label{s:deactivate_leak_old}

Bank keeps all unused passwords in a list. 

\begin{lstlisting}[language=chainmail, mathescape=true, frame=lines]

class Bank

     Password makePassword( ) {
          p := new Password
          this.listUnusedPwds.enter(p) 
          return p;                    
     }
     
     Password getMeAPassword(){
          p := this.listUnusedPwds.popAndTop();
          return p;
     }
     
...
\end{lstlisting}

\subsection{BlackAdder's Box}
\label{s:blackadder_box}

Below is a variant of the example of 2.3.1 where the Bank Account has a box field 
that may contain the password. If it contains the password, then it will allow anyone to change the balance.

\begin{lstlisting}[language=chainmail, mathescape=true, frame=lines]
mod BankAccount
  class BankAccount
    field password
    field balance
    field box
    meth transfer(pwd, to)
      if pwd == password || box.open() == password
        this.balance -= 10
        to.balance += 10
    meth setBox(b)
      this.box = b
    meth setPassword(pwd, newP)
      if this.password == pwd
        this.password = newP
      
mod Ext
  class Box
    field thing
    meth open()
      return thing
    meth setThing(t)
      this.thing = t
    
mod Client
  class BlackAdder
    meth doSomething()
      a = new Account()
      p = new Password()
      b = new Box()
      b.setThing(p)
      a.setPassword(null, p)
      a.setBox(b)
      u = new Unknown()
      u.stuff(a)
\end{lstlisting}
