\newcommand{\SPSF}{\SPS \ \ \ \ \ \ \ }
\newcommand{\Aop}{A_{pr}}

\subsection{Proof of Theorem \ref{t:quadruple:sound} }
\label{s:app:proof:sketch;quadruples}
\noindent
\vspace{.2cm}
  {\textbf{Begin Proof}} 


\noindent
Take any $M$, $\Mtwo$, with\\ 
$\strut \ \ \hspace{2.3cm} \ \ (1) \ \ \vdash M $.
\\
We will prove that\\
$\strut \ \ \hspace{2.3cm} \ \ (*)\ \ \forall \sigma, A, A', A''.$\\
$\strut \ \ \hspace{2.3cm} \ \ \ \ \  \ \ [ \ M\ \vdash\  \quadruple {A} {\sigma.\prg{cont}} {A'} {A''}  \ \ \Longrightarrow \ \    M\ \modelsD\  \quadruple {A} {stmt} {A'} {A''}\ ]$.\\
by induction on the well-founded ordering  $\_ \ll_{M,\Mtwo}  \_$.
\\
Take $\sigma$, $A$, $A'$, $A''$, $\overline z$, $\overline w$, $\overline \alpha$, $\sigma'$, $\sigma''$  arbitrary. Assume that\\
$\strut \ \ \hspace{2.3cm} \ \ (2) \ \ M\ \vdash\  \quadruple {A} {\sigma.\prg{cont}} {A'} {A''}$\\
$\strut \ \ \hspace{2.3cm} \ \ (3) \ \ \overline {w}=\fv(A)\cap dom(\sigma), \  \ \ \  \overline z = \sdN{\fv(A)\setminus dom(\sigma)}$\footnote{Remember that $dom(\sigma)$ is the set of variables defined in the top frame of $\sigma$} \\
%\setminus( \vs({\sigma.\prg{cont}}) \cup dom(\sigma) \} )}$ \\ %\setminus \vs(\sigma.\prg{cont} ) = \overline z$\\
$\strut \ \ \hspace{2.3cm} \ \ (4) \ \ \satDAssertFrom M  \sigma k   {A\sdN{[{\overline { \alpha/z}]}}}$\\
To show\\
$\strut \ \ \hspace{2.3cm} \ \ (**)\ \ \  \ \    \leadstoBoundedStarFin {\Mtwo\cdot M}  {\sigma}  {\sigma'}\ \ \Longrightarrow\ \     \satDAssertFrom M  {\sigma'} k   {\sdN{A'}\sdN{[{\overline {\alpha/z}]}}}$\\
$\strut \ \ \hspace{2.3cm} \ \ (*\!*\!*) \ \ \,    \leadstoBoundedStar  {\Mtwo\cdot M}  {\sigma}  {\sigma''}\ \, \ \ \Longrightarrow\ \     \satDAssertFrom M  {\sigma''}  k  \extThis \rightarrow {\sdN{A''[{\overline {\alpha/z}}][\overline{\interpret \sigma {w}/w}]}}$
 
 \vspace{.2cm}
\noindent
We proceed by case analysis on the  rule applied in the last step of the proof of (2). We only describe some cases.

\begin{description} 
 
 \item[{\sc{mid}}] 
 
 By Theorem \ref{l:triples:sound}.

\newcommand{\SPS}{\strut \ \ \hspace{0.5cm} \ \ }
 
\item[{\sc{sequ}}] 
Therefore, there exist statements $stmt_1$ and $stmt_2$, and assertions  $A_1$, $A_2$ and $A''$, so that $A_1\txteq A$, and $A_2 \txteq A'$, and $\sigma.\prg{cont}\txteq  stmt_1; stmt_2$, and ... TO REVISIT
% $\overline z = \fv(A) \setminus (\vs(stmt_1) \cup \vs(stmt_2))$, and
%the proof of  $(2)$ %$M\ \vdash\  \{\, A \,  \}\ s_1;s_2\  \{\, A' \, \}$ in $P$ 
%has as its immediate predecessors proofs for \\
%$\SPS (5)\ \ M\ \vdash\  \quadruple {A_1} {stmt_1} {A_2} {A''}$,\ \ \ \  and\\
%$\SPS (6)\ \  M\ \vdash\  \quadruple {A_2} {stmt_2} {A_3} {A''}$.
%
%Define $\sigma_1$ as  $\sigma_1 \triangleq \sigma[\prg{cont} \mapsto stmt_1]$.
%Therefore,  $(A_1,\sigma_1,A_2, A'') \ll_{M,\Mtwo} (A_1,\sigma,A_3, A'')$. 
%
%%\vspace{.1cm}
%%Proving $(*\!*\!*)$. Assume that $\leadstoBoundedStarFin {\Mtwo\cdot M}  {\sigma}  {\sigma'}$. Then, by lemma \ref{lemma:subexp} we obtain that there exists a $\sigma_1'$ such that $\leadstoBoundedStarFin {\Mtwo\cdot M}  {\sigma_1}  {\sigma_1'}$,
%%and $\leadstoBoundedStarFin {\Mtwo\cdot M}  {\sigma_2}  {\sigma'}$, where $\sigma_2 \triangleq \sigma_1'[\prg{cont} \mapsto stmt_2]$. Moreover,  $(A_2,\sigma_2,A_3,A'') \ll_{M,\Mtwo} (A_1,\sigma,A_3, A'')$.
%%
%%We will use the following abbreviations: \\
%%$\SPS (7)\ \ \overline {z_3}\triangleq\vs(stmt_1)\setminus\vs(stmt_2) \ \ \ \ \ \overline {z_4}\triangleq\vs(stmt_2)\setminus\vs(stmt_1) $.\\
%%Then we have\\
%%$\SPS  (8)\ \ \fv(A)\setminus\vs(stmt_1) = \overline {z}\cup \overline{z_4}  \ \ \ \ \ 
%%\fv(A)\setminus\vs(stmt_2) = \overline {z}\cup\overline{z_3} $.
%%\\
%% From (4), and Lemma \ref{lemma:addr:expr}, we obtain\\ 
%% $\SPS (9) \ \ \satDAssertFrom M  {\sigma_1} k   {A_1[\overline{\alpha/z}][\overline{{\interpret {\sigma_1} {z_4}} /z_4}]}$\\
%% We apply the induction hypothesis, and obtain\\
%%  $\SPS (10) \ \ \satDAssertFrom M  {\sigma_1'} k   {A_2[\overline{\alpha/z}][\overline{{\interpret {\sigma_1} {z_4}} /z_4}]}$\\
%%By Lemmas \ref{l:var:unaffect} and \ref{l:assrt:unaffect} and (7) we have that ${\overline{{\interpret {\sigma_1} {z_4}} /z_4}]}$=${\overline{{\interpret {\sigma_1'} {z_4}} /z_4}]}$=${\overline{{\interpret {\sigma_2} {z_4}} /z_4}]}$, and this, applied to (10) and again with Lemma \ref{lemma:addr:expr} gives us\\
%% $\SPS (11) \ \ \satDAssertFrom M  {\sigma_2} k   {A_2[\overline{\alpha/z}]}$\\
%%We apply Lemma \ref{lemma:addr:expr} again, and obtain\\
%% $\SPS (12) \ \ \satDAssertFrom M  {\sigma_2} k   {A_2[\overline{\alpha/z}][{\overline{{\interpret {\sigma_2} {z_3}} /z_3}}]}$\\
%% We apply again the induction hypothesis, and obtain\\
%%  $\SPS (13) \ \ \satDAssertFrom M  {\sigma'} k   {A_3[\overline{\alpha/z}][\overline{{\interpret {\sigma_1} {z_3}} /z_3}]}$\\
% 
%NEEDS REVISITING
%%\\
%%By similar argument as earlier, we obtain:\\
%% $\SPS (\alpha') \ \ \satDAssertFrom M  {\sigma'} k   {A_3[\overline{\alpha/z}]}$ 
%% 
%% \vspace{.1cm}
%%Proving $(*\!*\!*)$.
%%Let us now take an arbitrary $\sigma''$ such that   $\leadstoBoundedStar  {\Mtwo\cdot M}  {\sigma}  {\sigma''}$. By
%%lemma  \ref{lemma:subexp}, either $\leadstoBoundedStar  {\Mtwo\cdot M}  {\sigma_1}  {\sigma''}$ or
%%$\leadstoBoundedStar  {\Mtwo\cdot M}  {\sigma_2}  {\sigma''}$. 
%%
%%In the first case, where $\leadstoBoundedStar  {\Mtwo\cdot M}  {\sigma_1}  {\sigma''}$ we apply the inductive hypothesis, and obtain $(\beta')$, ie that \ \ $ M, \sigma'' \models \extThis \rightarrow A''[\overline{\alpha/z}]$.
%%
%% The second case is analogous.
 
  \item[{\sc{combine}}]  by induction hypothesis, and unfolding and folding the definitions
  
 \item[{\sc{consequ}}]  using Lemma \ref{l:shallow:deep} part \ref{fourSD}  and axiom \ref{lemma:axiom:enc:assert:ul}

\item[{\sc{Call\_Int}}]
 
 Therefore, there exist $u$, $y_o$, $C$, $\overline y$,  $A_{pre}$, $A_{post}$, and $A_{mid}$, such that \\
 $\SPS (5) \ \ \sigma.\prg{cont}\txteq u:=y_0.m(\overline y)$,\\
% $\SPS (5a) \ \ \{ u, y_0, ... y_n \}  \subseteq \overline w $, \ \ $\overline z \cap  \{ u, y_0, ... y_n \}  = \emptyset$ \\ 
$\SPS (6) \  \ \promises  M {\mprepostN {A_{pre}}{D}{m}{x}{D}{A_{post}} {A_{mid}}}$, \\
$\SPS (7) \  \ A \txteq y_0:D ,\overline {y:D}\ \wedge \  A_{pre}[y_0,\overline y/\prg{this},\overline x],$\\
$\SPSF  A'  \txteq A_{post}[y_0,\overline y, u/\prg{this},\overline x, \prg{res}],$\\ 
$\SPSF  A'' \txteq  A_{mid}$. 
\\
Also, \\
$\SPS (8) \ \ \leadstoBounded  {\Mtwo\cdot M}  {\sigma}  {\sigma_1}$, \\
 where \\
$\SPS (8a) \ \ \ \sigma_1\triangleq (\PushSLong { (\prg{this}\mapsto {\interpret{\sigma} {y_0}},{\overline{x \mapsto {\interpret{\sigma} {y}}}})}\sigma [\prg{cont}\mapsto stmt_m]$, \\ 
$\SPS (8b) \ \ \   \prg{mBody}(m,D,M)=\overline{y:D}\{\    stmt_m\ \}$ .\\
We define the shorthand:\\
$\SPS (9) \ \  \Aop \triangleq  \prg{this}:D,\overline{x:D}\, \wedge\, A_{pre}$.
\\
By (1), (7), and definition of $\vdash M$ in Section \ref{sect:wf}, we obtain\\
$\SPS (10) \ \  M \vdash  \quadruple { \ \Aop \  } {\ stmt_m } {\ A_{post}\ } {A_{mid}}$.\\
From (8) we obtain\\  
$\SPS (11) \ \ (\Aop,\sigma_1,A_{post}, A_{mid}) \ll_{M,\Mtwo} (A,\sigma,A', A'')$
\\
In order to be able to apply the induction hypothesis, we need to prove something of the form $... \sigma_1 \models \Aop[../fv(\Aop)\setminus dom(\sigma_1)]$. To that aim we will apply Lemma   \ref{l:calls} part \ref{l:calls:callee:one} on (4), (8a) and (9). For this, we take
\\
$\SPS (12) \ \ \ \overline {v_1} \triangleq \prg{this},\overline x$, \ \ \ 
$\overline {v_2} \triangleq  \fv(\Aop)\setminus \overline {v_1}$, \ \ \ 
$\overline {v_3} \triangleq  y_0,\overline y$,\ \ \ 
$\overline {v_4} \triangleq  \fv(A)\setminus \overline {v_3}$
%,\overline {v_2})$.
% \ $\overline {\alpha_2} \triangleq  \overline \alpha$,\ \ $\overline {v_6} \triangleq  y_0 $, \ \  $\overline {v_4} \triangleq  \fv(A)\setminus \{  \overline {v_1},  \overline {v_6}, \overline z \}$,  
\\
These definitions give that
\\
$\SPS (12a) \ \  A \txteq \Aop[\overline {v_3/v_1}]$,
\\
$\SPS (12b)  \ \  \fv(\Aop)\ =\overline{v_1}; \overline {v_2}$.
\\ 
$\SPS (12c)  \ \  \fv(A)\ =\overline {v_3};\overline {v_4} $.
\\
%The disjointness precondition of {\sc{Call\_Int}} gives that\\
%$\SPS (12d)  \ \  \overline {v_3}\, \#\, \overline {v_1}, \overline {v_5}$.
%\\
With (12a), (12b), (12c), (12d)  and Lemma \ref{l:sfs}  part (\ref{l:sfs:five}), we obtain that \\ 
$\SPS (12d)\ \    \overline {v_2} =   \overline{y_r}; \overline{v_4}$, \ \ \ \ where $\overline{y_r}\triangleq {\overline {v_2}}\cap  \overline {v_3}$
\\
Furthermore, (8a), and (12) give that:\\
$\SPS (12e) \ \  \overline { {\interpret {\sigma_1} {v_1}} = {\interpret {\sigma} {v_3}} }$
\\
%Moreover,   $y_0,\overline y \subseteq dom(\sigma)$, and with (3), we obtain that $\overline z \subseteq \overline {v_4}$. We define\\
%$\SPS (12f) \ \ \overline {v_5} \triangleq  \overline {v_4}\setminus \overline {z}$\ \ \ \ \ \ \ which implies\ \ $ \overline {v_4} = \overline z; \overline{v_5}$
%\\
Then, (4),  (12a),   (12c) and (12f)  give that\\
$\SPS (13) \ \ \satDAssertFrom M  {\sigma} {k}   {\Aop[\overline{v_3/v_1}][\overline{\alpha/z}]}$\\
Moreover, we have that $\overline z \# \overline {v_3}$. From   Lemma \ref{l:sfs}  part (\ref{l:sfs:seven}) we obtain $\overline z \# \overline {v_1}$. 
And, because $\overline \alpha$ are addresses wile $\overline {v_1}$ are variables, we also have that $\overline \alpha\#\overline {v_1}$.
These facts, together with   Lemma \ref{l:sfs}  part (\ref{l:sfs:six}) give that\\
$\SPS (13a) \ \    \Aop[\overline{v_3/v_1}][\overline{\alpha/z}] \txteq   \Aop[\overline{\alpha/z}]  [\overline{v_3/v_1}] $\\
From (13a) and (13), we obtain
\\
$\SPS (13b) \ \     \satDAssertFrom M  {\sigma} {k}   { \Aop[\overline{\alpha/z}]  [\overline{v_3/v_1}] }$\\
\\
From (4), (8a), (12a)-(12e)  we see that the requirements  %\ref{l:calls:r:one}-\ref{l:calls:r:four} 
 of Lemma \ref{l:calls}  part  \ref{l:calls:callee:one} are satisfied where we take  $\Ao$ to be $\Aop[\overline{\alpha/z}]$.
 We use the definition of $y_r$ in (12d), and define\\
$\SPS (13c) \ \ \overline {v_6} \triangleq  y_r;  (\overline {v_4}\setminus \overline{z})$
\\
One can see that $\overline {v_6} \subseteq dom(\sigma)$.
We apply   Lemma   \ref{l:calls} part \ref{l:calls:callee:one} on (13b), (13c)  and  obtain\\
$\SPS (14) \ \  \satDAssertFrom M  {\sigma_1} {k}   {\Aop[\overline{\alpha/z}][\overline{\interpret{\sigma}{v_6}/v_6] }}$. \\

For the proof of $(**)$ as well as for the proof of $(*\!*\!*)$, we will want to apply the inductive hypothesis.   For this, we need to determine the value of  
$\fv(\Aop)  \setminus dom(\sigma_1)$, as well as the value of $\fv(\Aop)  \cap dom(\sigma_1)$. 
  This is what we do next. From (8a) we have that\\
$\SPS (15a) \ \  dom(\sigma_1)=\{ \prg{this}, \overline x \}$.\\
This, with (12)  and (12b)  gives  that\\
$\SPS (15b) \ \ \fv(\Aop)\cap dom(\sigma_1)= \overline {v_1}$.\\
$\SPS (15c) \ \  \fv(\Aop)  \setminus dom(\sigma_1) = \overline {v_2}$. \\
Moreover, (12d) and (13c) give that\\
$\SPS (15d) \ \  \fv(\Aop)  \setminus dom(\sigma_1) = \overline {z}; \overline{v_6}$.

\newcommand{\Aopa}{A_{o,a}}

 \vspace{.3cm}
Proving $(**)$. Assume that   $\leadstoBoundedStarFin  {\Mtwo\cdot M}  {\sigma}  {\sigma'}$. Then, by the operational semantics, we obtain that 
there exists state $\sigma_1'$, such that \\
$\SPS (16) \ \ \leadstoBoundedStarFin  {\Mtwo\cdot M}  {\sigma_1}  {\sigma_1'}$ \\
$\SPS (17) \ \ \sigma'=(\sigma_1'\popSymbol)[u \mapsto {\interpret {\sigma_1'} {\prg{res}}}][\prg{cont}\mapsto \epsilon]$.
\\
We now apply the induction hypothesis on (14), (16), (15d), and obtain
\\ 
$\SPS (18) \ \  \satDAssertFrom M  {\sigma_1'} {k}   {(A_{post})[\overline{\alpha/z}][\overline{\interpret {\sigma} {v_6} /v_6}]}$.
\\
We now want to obtain something of the form $...\sigma' \models ...A'$. We now want to be able to apply   Lemma \ref{l:calls:return},  part \ref{l:calls:caller:one} on (18). Therefore, we  define
\\
$\SPS (18a) \ \  \Aopa \triangleq  A_{post}[\overline{\alpha/z}][\overline{\interpret {\sigma} {v_6} /v_6}]$
\\
$\SPS (18b) \ \  \overline {v_{1,a}} \triangleq  \overline {v_1}, \prg{res}$,   \ \ \ \ 
$\overline {v_{3,a}} \triangleq  \overline {v_3}, u$.
\\
Because of (6),  (9), (12d) and (18b) and because the wellformedness condition for specifications requires that $\fv (A_{post}) \subseteq  \fv (A_{pre}) \cup \{ \prg{res} \}$, we have   \\
$\SPS (19a) \ \  \fv(\Aopa) \subseteq  \overline {v_{1,a}}, \overline {v_{2,a}}$
\\
Also, by (18b), and (17), we have that   
\\
$\SPS (19b) \ \ \overline {\interpret {\sigma'} {v_{3,a}}  =  \interpret {\sigma_1'} {v_{1,a}} }$.
\\
From (4) we obtain that  $ k \leq \DepthSt {\sigma}$. From  (8a) we obtain that $ \DepthSt {\sigma_1} = \DepthSt {\sigma} +1$. From (16) we obtain that  $ \DepthSt {\sigma_1'} = \DepthSt {\sigma_1}$, and from (17) we obtain that $ \DepthSt {\sigma'} = \DepthSt {\sigma_1'} -1$. All this gives that:\\
$\SPS (19c) \ \ k \leq \DepthSt {\sigma'}$
\\
We now apply  Lemma \ref{l:calls:return},  part \ref{l:calls:caller:one}, and obtain  
\\
$\SPS (20) \ \  \satDAssertFrom M  {\sigma'} {k}   {\Aopa[\overline{v_{3,a}/v_{1,a}}]}$.
\\
We expand the definition from (18), and re-order the substitutions by a similar argument as in in step 13a, using Lemma    part (\ref{l:sfs:six}), and obtain\\
$\SPS (20a) \ \  \satDAssertFrom M  {\sigma'} {k}   {\A_{post}[\overline{v_{3,a}/v_{1,a}}][\overline{\alpha/z}][\overline{\interpret {\sigma} {v_6} /v_6}]}$.
\\
By  (20a),   (18b),  and because  by Lemma \ref{l:var:unaffect} we have that $\overline{\interpret {\sigma} {v_6}}$=$\overline{\interpret {\sigma'} {v_6}}$, we  obtain
\\
$\SPS (21) \ \ \satDAssertFrom M  {\sigma'} {k}   {(A_{post})[y_0,\overline y, u/\prg{this},\overline x, \prg{res}][\overline{\alpha/z}]}. $. 
\\
With (7) we conclude.




 \vspace{.3cm}
Proving $(*\!*\!*)$. Take a $\sigma''$. Assume that\\
$\SPS (15) \ \ \leadstoBoundedStar   {\Mtwo\cdot M}  {\sigma}  {\sigma''}$\\
$\SPS (16) \ \ \ {\Mtwo\cdot M}, \sigma'' \models \extThis$.\\
Then, from (8) and (15) we also obtain that\\
$\SPS (15) \ \ \leadstoBoundedStar   {\Mtwo\cdot M}  {\sigma_1}  {\sigma''}$\\
By (10), (11) and application of the induction hypothesis on (13),  (14c), and (15), we obtain that\\

$\SPS (\beta') \ \  \satDAssertFrom M  {\sigma''} {k}   {A_{mid}[\overline{\alpha/z}][\overline{\interpret \sigma {w}/w}]}$.\\
and using (7) we are done.



\item[{\sc{Call\_Int\_Adapt}}] is similar to {\sc{Call\_Int}}. 
We highlight the differences in \npgreen{green}.
Therefore, there exist $u$, $y_o$, $C$, $\overline y$,  $A_{pre}$, $A_{post}$, and $A_{mid}$, such that \\
 $\SPS (5) \ \ \sigma.\prg{cont}\txteq u:=y_0.m(\overline y)$,\\
% $\SPS (5a) \ \ \{ u, y_0, ... y_n \}  \subseteq \overline w $, \ \ $\overline z \cap  \{ u, y_0, ... y_n \}  = \emptyset$ \\ 
$\SPS (6) \  \ \promises  M {\mprepostN {A_{pre}}{D}{m}{x}{D}{A_{post}} {A_{mid}}}$, \\
$\SPS (7) \  \ A \txteq y_0:D ,\overline {y:D}\ \wedge \  \PushASLongG {({y_0, \overline y})} {(A_{pre} [y_0/\prg{this}])},$ \\
$\SPS \ \ \ \  A'  \txteq \PushASLongG  {({y_0, \overline y})} {(A_{post}[y_0/\prg{this},u/res])},$\\
$\SPS\ \ \ \   A'' \txteq  A_{mid}$. 
\\
Also, \\
$\SPS (8) \ \ \leadstoBounded  {\Mtwo\cdot M}  {\sigma}  {\sigma_1}$, \\
 where \\
$\SPS (8a) \ \ \ \sigma_1\triangleq (\PushSLong { (\prg{this}\mapsto {\interpret{\sigma} {y_0}},{\overline{x \mapsto {\interpret{\sigma} {y}}}})}\sigma [\prg{cont}\mapsto stmt_m]$, \\ 
$\SPS (8b) \ \ \   \prg{mBody}(m,D,M)=\overline{y:D}\{\    stmt_m\ \}$ .\\
We define the shorthand:\\
$\SPS (9) \ \  \Aop \triangleq  \prg{this}:D,\overline{x:D}\, \wedge\, A_{pre}$.
\\
By (1), (7), and definition of $\vdash M$ in Section \ref{sect:wf}, we obtain\\
$\SPS (10) \ \  M \vdash  \quadruple { \ \Aop \  } {\ stmt_m } {\ A_{post}\ } {A_{mid}}$.\\
From (8) we obtain\\  
$\SPS (11) \ \ (\Aop,\sigma_1,A_{post}, A_{mid}) \ll_{M,\Mtwo} (A,\sigma,A', A'')$
\\
In order to be able to apply the induction hypothesis, we need to prove something of the form $... \sigma_1 \models \Aop[../fv(\Aop)\setminus dom(\sigma_1)]$. To that aim we will apply \npgreen{Lemma   \ref{l:calls} part \ref{l:calls:callee:two}} on (4), (8a) and (9). For this, we take
\\
$\SPS (12) \ \ \ \overline {v_1} \triangleq \prg{this},\overline x$, \ \ \ 
$\overline {v_2} \triangleq  \fv(\Aop)\setminus \overline {v_1}$, \ \ \ 
$\overline {v_3} \triangleq  y_0,\overline y$,\ \ \ 
$\overline {v_4} \triangleq  \fv(A)\setminus \overline {v_3}$\\
These definitions give that
\\
$\SPS (12a) \ \  A \txteq  \PushASLongG {({y_0, \overline y})} {\Aop[\overline {v_3/v_1}]}$,
\\
$\SPS (12b)  \ \  \fv(\Aop)\ =\overline{v_1}; \overline {v_2}$.
\\ 
$\SPS (12c)  \ \  \fv(A)\ =\overline {v_3};\overline {v_4} $.
\\
%The disjointness precondition of {\sc{Call\_Int}} gives that\\
%$\SPS (12d)  \ \  \overline {v_3}\, \#\, \overline {v_1}, \overline {v_5}$.
%\\
With (12a), (12b), (12c), (12d)  and Lemma \ref{l:sfs}  part (\ref{l:sfs:five}), we obtain that \\ 
$\SPS (12d)\ \    \overline {v_2} =   \overline{y_r}; \overline{v_4}$, \ \ \ \ where $\overline{y_r}\triangleq {\overline {v_2}}\cap  \overline {v_3}$
\\
Furthermore, (8a), and (12) give that:\\
$\SPS (12e) \ \  \overline { {\interpret {\sigma_1} {v_1}} = {\interpret {\sigma} {v_3}} }$
\\
%Moreover,   $y_0,\overline y \subseteq dom(\sigma)$, and with (3), we obtain that $\overline z \subseteq \overline {v_4}$. We define\\
%$\SPS (12f) \ \ \overline {v_5} \triangleq  \overline {v_4}\setminus \overline {z}$\ \ \ \ \ \ \ which implies\ \ $ \overline {v_4} = \overline z; \overline{v_5}$
%\\
Then, (4),  (12a),   (12c) and (12f)  give that\\
$\SPS (13) \ \ \satDAssertFrom M  {\sigma} {k}   {\PushASLongG {({y_0, \overline y})} {\Aop[\overline {v_3/v_1}]}}$\\
Moreover, we have that $\overline z \# \overline {v_3}$. From   Lemma \ref{l:sfs}  part (\ref{l:sfs:seven}) we obtain $\overline z \# \overline {v_1}$. 
And, because $\overline \alpha$ are addresses wile $\overline {v_1}$ are variables, we also have that $\overline \alpha\#\overline {v_1}$.
These facts, together with   Lemma \ref{l:sfs}  part (\ref{l:sfs:six}) give that\\
$\SPS (13a) \ \    {\Aop[\overline{v_3/v_1}][\overline{\alpha/z}]}  \txteq     {\Aop[\overline{\alpha/z}]  [\overline{v_3/v_1}] }$\\
From (13a) and (13), we obtain
\\
$\SPS (13b) \ \     \satDAssertFrom M  {\sigma} {k}    {\PushASLongG {({y_0, \overline y})} {( \Aop[\overline{\alpha/z}]  [\overline{v_3/v_1}] )}}$\\
\\
From (4), (8a), (12a)-(12e)  we see that the requirements  %\ref{l:calls:r:one}-\ref{l:calls:r:four} 
 of Lemma \ref{l:calls}  part  \ref{l:calls:callee:two} are satisfied where we take  $\Ao$ to be $???$.
  We use the definition of $y_r$ in (12d), and define\\
$\SPS (13c) \ \ \overline {v_6} \triangleq  y_r;  (\overline {v_4}\setminus \overline{z})$
\\
PPPPPP
%\\
%Therefore, there exist there exist $u$, $y_o$, $C$, $\overline y$,  $A_{pre}$, $A_{post}$, and $A_{mid}$, such that \\
% $\SPS (5) \ \ \sigma.\prg{cont}\txteq u:=y_0.m(\overline y)$,  \ \ \ \ $\overline z = \fv(A)\setminus \{ u, y_0, ... y_n \}$
%\\ 
%$\SPS (6) \  \ \promises  M {\mprepostN {A_{pre}}{D}{m}{y}{D}{A_{post}} {A_{mid}}}$, \\
%$\SPS (7) \  \ A \txteq y_0\!:\!D,\overline {y:D}\ \wedge \ \PushASLongG {({y_0, \overline y})} {(A_{pre} [y_0/\prg{this}])},$ \\
%$\SPS \ \ \ \  A'  \txteq \PushASLongG  {({y_0, \overline y})} {(A_{post}[y_0/\prg{this},u/res])},$\\
%$\SPS \ \ \ \  A'' \txteq  A_{mid}$. 
%\\
%Also, \\
%$\SPS (8) \ \ \leadstoBounded  {\Mtwo\cdot M}  {\sigma}  {\sigma_1}$, \\
% where \\
%$\SPS (8a) \ \ \ \sigma_1\triangleq (\PushSLong { (\prg{this}\mapsto {\interpret{\sigma} {y_0}},{\overline{y \mapsto {\interpret{\sigma} {y}}}})}\sigma [\prg{cont}\mapsto stmt_m]$, \ \ \ \  \ \  and where\\
%$\SPS (8b) \ \ \   \prg{mBody}(m,D,M)=\overline{y:D}\{\    stmt_m\ \}$ .\\
%By (1), (7), and definition of $\vdash M$ in Section \ref{sect:wf}, we obtain\\
%$\SPS (9) \ \ M \vdash  \quadruple { \ \prg{this}:D,\overline{y:D}\, \wedge\, A_{pre}\  } {\ stmt_m } {\ A_{post}\ } {A_{mid}}$.\\
%From (8) and (9) we obtain  \\
%$\SPS (10) \ \ (\prg{this}:D,\overline{y:D}\, \wedge\, A_{pre},\sigma_1,A_{post}, A_{mid}) \ll_{M,\Mtwo} (A,\sigma,A', A'')$. 
%\\
%By (1), (7)   and Lemma   \ref{l:calls} part \npgreen{\ref{l:calls:callee:two}},  we obtain\\
%% $\SPS (11) \ \  \satDAssertFrom M  {\sigma_1} {\npgreen{\DepthSt {\sigma_1}}}  {(\prg{this}:D,\overline{y:D}\, \wedge\, (A_{pre}[\overline{\alpha/z}])}$.
%$\SPS (11) \ \ \npgreen{ M, \sigma_1 \models ...}$
%
% \vspace{.1cm}
%Proving $(**)$. Assume that   $\leadstoBoundedStarFin  {\Mtwo\cdot M}  {\sigma}  {\sigma'}$. Then, by the operational semantics, we obtain that 
%there exists state $\sigma_1'$, such that \\
%$\SPS (12) \ \ \leadstoBoundedStarFin  {\Mtwo\cdot M}  {\sigma_1}  {\sigma_1'}$ \\
%$\SPS (13) \ \ \sigma'=(\sigma_1'\popSymbol)[u \mapsto {\interpret {\sigma_1'} {res}}][\prg{cont}\mapsto \epsilon]$.
%\\
%Using (9), (10), and because by Barendregt we can assume that $\fv(A)\cap \vs(stmt_m) = \emptyset$, we can apply the inductive hypothesis, and obtain\\
%$\SPS (14) \ \  \satDAssertFrom M  {\sigma_1'} {\npgreen{\DepthSt {\sigma_1'}}}    {\prg{this}:D,\overline{y:D}\, \wedge\, (A_{post}[\overline{\alpha/z}])}$.
%\\
%By (13), (14) and Lemma  \ref{lemma:push:ass:state} part \ref{lemma:push:ass:state:two}, and $\models \sigma_1'$, we obtain\\
%$\SPS (16) \ \  \satDAssertFrom M  {\sigma'}  {\npgreen{\DepthSt {\sigma'}}}  {\npgreen {\PushAS y {(A_{post}[y_0/ \prg{this},u/res][\overline{\alpha/z}])}}}$.\\
% and using Lemma \npgreen{\ref{l:adapt:stable} and \ref{l:shallow:deep} part \ref{fiveSD}}, and \npgreen{because $\overline z \cap \overline y = \emptyset$}   we obtain \\
%$\SPS (\alpha') \ \  \satDAssertFrom M  {\sigma'}  {\npgreen{k}}  {\npgreen {(\PushAS y {(A_{post}[y_0/ \prg{this},u/res])})}[\overline{\alpha/z}]}$
%
% \vspace{.1cm}
%Proving $(*\!*\!*)$. Similar.
%
%\item[{\sc{Call\_Ext\_Adapt}}] is similar to {\sc{Call\_Int\_Adapt}}. with the difference that it also uses Lemma \ref{lemma:external_exec_preserves_more}, part (3).
% It uses  Lemmas
% \ref{lemma:push:ass:state} part \ref{lemma:push:ass:state:one}, then \ref{lemma:external_exec_preserves_more}, part (3),  and   \ref{l:adapt:stable} and \ref{l:shallow:deep}
% then again \ref{lemma:push:ass:state}, part \ref{lemma:push:ass:state:two}.
% To fulfill the second premise of Lemma  \ref{lemma:external_exec_preserves_more}, part (3), we make use of the fact that $\vdash M$, and apply the rule {\sc{Method}}, and the inductive hypothesis.
\end{description}
\noindent
\vspace{.1cm}
  {\textbf{End Proof Sketch}} 

\subsection{Proof Sketch of Theorem  \ref{thm:soundness}}

\label{s:app:proof:sketch;overall}
 {\textbf{Proof Sketch}}
 By induction on the  cases for the specification $S$. If it is a method spec, then the theorem follows from \ref{t:quadruple:sound}. If it is a conjunction, then by inductive hypothesis.
 \\
 The interesting case is $S \txteq {\TwoStatesN {\overline {x:C}} {A}}$.
 \\
 Assume that 
 $ \satDAssertFrom M  {\sigma} k A[\overline {\alpha/x} ]$, that  $M,\sigma \models \extThis$,
 that $\leadstoBoundedStar  {M\cdot \Mtwo}  {\sigma}  {\sigma'}$, and that $M,\sigma \models \extThis$,
 \\ 
 We want to show that $ \satDAssertFrom M  {\sigma'} k A[\overline {\alpha/x} ]$.
 \\
 Then, by lemma
 \ref{lemma:external_breakdown:term}, we obtain that either \\
$\strut \ \ \ \ \ $ (1)\  $\leadstoBoundedExtPub {\Mtwo\cdot M}    {\sigma}  {\sigma'}$, or\\
$\strut \ \ \ \ \ $  (2)\  $\exists \sigma_1,\sigma_2.[\
\leadstoBoundedExtPub {\Mtwo\cdot M}    {\sigma}  {\sigma_1}
\wedge\ \leadstoBounded  {\Mtwo\cdot M}    {\sigma_1}  {\sigma_2}
\wedge \ M, \sigma_2 \models \pubMeth \wedge \leadstoBoundedStar  {\Mtwo\cdot M}    {\sigma_2}  {\sigma'} \ ]$
\\
In Case (1), we apply  \ref{lemma:external_exec_preserves_more}, part (3).  In order to fulfill the second premise of Lemma  \ref{lemma:external_exec_preserves_more}, part (3), we make use of the fact that $\vdash M$,   apply the rule {\sc{Method}}, and theorem \ref{t:quadruple:sound}.
This gives us $ \satDAssertFrom M  {\sigma'} k A[\overline {\alpha/x} ]$
\\
In Case (2), we proceed as in (1) and obtain that $ \satDAssertFrom M  {\sigma_1} k A[\overline {\alpha/x} ]$. Because $M \vdash \encaps A$, we also obtain that 
$ \satDAssertFrom M  {\sigma_2} k A[\overline {\alpha/x} ]$.
Since we are now executing a public method, and because $\vdash M$, we can apply {\sc{Invariant}}, and theorem \ref{t:quadruple:sound}, and obtain $ \satDAssertFrom M  {\sigma'} k A[\overline {\alpha/x} ]$\\
 \vspace{.1cm}
  {\textbf{End Proof Sketch}} 