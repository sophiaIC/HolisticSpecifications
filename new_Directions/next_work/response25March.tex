\documentclass{article}

\usepackage[a4paper, total={6in, 8in}]{geometry}

 %\geometry{a4paper,margin=7mm,bindingoffset=25mm,heightrounded,}

%\usepackage[12pt, a4paper]{article}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}

 \newcommand{\pair}[2]{\noindent $>$\  \emph{#1}   \\ {#2}\\ \vspace{.1pt}}

%% Some recommended packages.
 \usepackage{relsize}
\usepackage{mathpartir}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{xspace}
\usepackage{definitions}
\usepackage{multirow,bigdelim}
\usepackage{pbox}
\usepackage{courier}
\usepackage{soul}
\usepackage{centernot}

%\newcommand\multibrace[3]{\rdelim\}{#1}{3mm}[\pbox{#2}{#3}]}
 

\begin{document}

%% Title information
%\title[Specification and Proof of Necessary Conditions]{Specification
%and Proof of Necessary Conditions}         %% [Short Title] is
%optional;
%\title{Necessity Specifications are Necessary}
\title{Reasoning about External Calls\\ \small{ -- Improvements --}} % made in the 25th March version}

%\begin{abstract}
%The changes made in the version as of 25th March \end{abstract}



%% End of generated code


%% Keywords
%% comma separated list
%%%%%%%%%%%%%%%%%%%%%\keywords{keyword1, keyword2, keyword3}  %% \keywords are mandatory in final camera-ready submission



%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.




\maketitle 



\section{ Improvements Required by Reviewers}

\begin{enumerate}
\item
We ensured that any terms in Section 2 are used only after their definition.
\item
We repaired annoying typos in the Definition of “protected”, and “deep satisfaction”.
\item
We expandedthe discussion of $Stbl$, $Stbl^+$, and  $Enc$ We added examples that demonstrate their differences, and explanations why these properties are needed.
\item
We clarified how the type system is used in reasoning about protection.
\item
We added the definition of well-formed specifications (Def 5.6), explained why the various requirements are made. Moreover in the definition of well-formed modules (line 978), we. reminded the reader about the requirement for well-formed specifications. 
\item
We explained how to obtain sound logics for assertions, even though “protection” is a new concept.
We replaced the term “scoped satisfaction” by “deep satisfaction” (lines 1033-1044). We improved the explanation that “deep satisfaction” as well as satisfaction (lines 719-723) are based on scoped execution. 
\item
We improved the bibliography.
\item
We shrunk the subsection on expressiveness to just 4 lines.
\item
We implemented all further  requests made by the reviewers.
\item We discuss the rationale of ghost code in lines 420-425, and give an example where ghost fields are used in Appendix A.3
\end{enumerate}


\section{Further Improvements -- not Required by the Reviewers }
\begin{enumerate}
\item
We introduced the notation $^\sigma\lceil A\rceil$ to substitute all free variables in $A$  by their values in $\sigma$ -- cf. Def. 4.5. This allows us to avoid some clutter in the notations -- cf Def. 5.2.
\item
Amalgamated old section 4 into section 3, and old section 6 into old section 5. Now the paper has 8 rather than 10 secretions, and is better balanced.
\item
Explained that our approach relies on the platform’s guarantees and could also be used for interlanguage safety -- footnote 4.
\end{enumerate}  


\section{Response to  Reviewer\_A}

Thank you for your comments in the First Round of reviewing.

\section{Response to Reviewer\_B }

\pair{ Fig. 1 is unreadable; please enlarge it}
{Done. We enlarged it, and removed from Fig. 2 the parts that were repeated from Fig. 1.}

\pair{  line 222: "objects, Object o4" $-->$ "objects. Object o4"}
{Done}

\pair{ line 480: "Fig. 9" $-->$ "Fig. 5"}
{Done}

\pair{line 526: two dots are hanging after the beginning of the definition. \\ I think some text is missing here}
{Repaired}

\pair{line 552: something is broken in this definition. There are two dots after $f_n$, and then the square bracket is open but not close.}
{Repaired: Removed superfluous dot, and added missing closing bracket.}

\pair{ line 572: "field,," $-->$  "fields,"}
{Repaired}

\pair{line 622-625: also here I have the feeling the definition is broken. In particular, I would expect that $\alpha'$ appears on the right-hand side of the implication. 
\\
As written now, I read the definition as: $\alpha'$ is [locally] reachable from $\alpha_0$ and external, and we cannot reach $\alpha$ from $\alpha_0$ in one step. Instead, in the description, I would have expected that the right-hand side would check if $\alpha'$ has a field reaching $\alpha$ (instead of $\alpha_0$ as it is written now). \\
Am I missing something?}
{You are spot on. The definition should have said $\alpha’.f\neq \alpha$ -- thank you for spotting this error in a very crucial definition in our paper.}

\pair{line 739, definition 7.4: \\ $\overline{M}$ is quantified but not used, maybe shuold be $\overline{M};M$ instead of just $M$ at line 740? \\
Also, I do not see the need to define $A'_3$, just use $A_3$ at line 740.}
{Exactly as you say! line 740 should have been $\overline{M};M$ instead of just $M$. \\
And as we do not need $A’_3$, we have slightly re-formatted the definition. \\
Thank you.}

\pair{line 759: "invariants. but" $-->$  "invariants, but"}
{done}

\pair{line 791, section 7.1: I would remove this section.\\
 It presents examples of applications of the approach at a too-high level that, on the one hand, does not allow us to understand if this is really the case; on the other hand, it looks like a bit of overselling.}
{Done; we only kept a summary of this section.}

\pair{bibliography: the various citations are not homogenous, and sometimes some pieces are missing. \\
Just as examples, [25, 30, 33, 39 56, 64, 77] all refer to ECOOP papers, but some of them report page numbers and others do not, some of them have the doi and others do not, and some reports Springer/LNCS others not, etc. The bibliographic entries should be carefully revised.}
{Done; we have homogenized the bibliography and added pages.}

\section{Response to Reviewer\_C}

We are deeply grateful to you, for the many pertinent comments, and for engaging with us in several rounds of discussion on hotcrp.
In the below we summarize the outcome of these discussions (hopefully Reviewer\_C agrees with our summary), and give our responses:

\vspace{.1cm}

\pair{1. Section 2  suffers in places from imprecision and bad technical writing. For example,   - the important notion of internal and external states ... }
{We moved the definition of internal/external states  to lines 199/200, ie the reader will have seen some states.}

\pair{- the critical idea behind the key notion of scoped invariants that internal states are not included shows up just in the final sentence in the para that introduces the scoped assertions, almost like an afterthought. }
{That is not quite true. In February’s submission, the text (lines 250-252) used to say 
    \begin{quote} $\forall  \overline {x:C}.A$ expresses that if a state $\sigma$  has objects $\overline x$ of class $\overline C$, and satisfies  $A$, then all $\sigma$'s external, scoped future states will also satisfy $A$.
    \end{quote}
However, we have now rephrased for better clarity, to   \begin{quote} 
all external states which are part of the scoped future of $\sigma$ will also satisfy $A$  \end{quote}
Cf -- line 248 in current submission.
}

\pair{the last part of section 2 that sketches the proof references for the first time well-formedness conditions about invariants, which are not explained earlier and are only described in the technical sections where it becomes apparent that they are an important for soundness"}
{
That is a very important point, which had escaped us. Thank you for alerting us. We have  given a short description of the requirement for $Stbl^+$ in sect 2.2, we have moved the Def. of well-formed specs to main paper (Def. 5.4) and discuss the rationale of the definition (lines762-772). Moreover, we remind the reader that well-formed specs are required for Module well-formedness (line978). \\
We did not move these point to Sect 2.2 as you had suggested, because we believe that this would be too much information too early.}

\pair{ not sure how the type system plays a role in the argument that \texttt{account.key} is protected by account }
{Another important point; thank you. We explain the role of types in sect 2 (lines 386-391), and also in section 6 (lines 1010-1015).}

\pair{ - in the well-formed modules para at the end of 2, the first sentence of this para is only indirectly connected to the rest of the para. In fact, the rest of the para is closer to the external calls para}
{We added explanations for what it means for a specification to be well-formed (and why the requirement needs to be made), and made a better bridge to the requirement for a proof of the method body of  \texttt{Shop::buy}. We also started the paragraph called “External Calls” with a discussion of proofs of method bodies.}

\pair{-  make sure that in section 2, all technical terms are introduced together or after all the other technical terms their meaning depends on.}
{We moved the Definition of “external state” to line 199. We have carefully read section 2, and checked that all terms are used only after their definition. }

\pair{ 2.  scoped semantics  - definition 7.4 i...I do not see how it achieves the "stopping before returning from the active call in σ" part of the scoped semantics
and also  -  explain in section 7 in detail how 7.4 captures the scoping constraints, in particular for invariants.}
{This is now Definition 5.4. We have improved the explanation of Def. 5.2, where we say "then any terminating scoped execution of its continuation" (line 716).
\\
 In example 5.3 we mention the $\leadsto$ relation, and explicitly talk of the states not covered because of stopping before returning. 
 \\
 Similarly, in section 2, line 255 and 273 we say which states are not  included, as they are not part of the scoped future.}
 
 \pair{3. Section 9 references in passing the judgment form for assertions and says that this is assumed to be sound with respect to the semantics in section 6. 
 \\
 However, assertions include protection assertions that are new to this work. So I do not think the workings of the proof system for assertions is obvious  }
{This is now Section 7. Right after Lemma 7.1, we added an argument that sound logics for assertions (including assertions which talk about protection) exist.
\\
 We expanded appendix G.1 to show that such an assertion logic can be built out of an assertion logic which does not talk about soundness, and that such a logic would preserve soundness. \\
We also argue after Lemma 9.1, that a sound underlying Hoare logic which does not talk about protection can be taken from the literature.
\\
Thank you for pointing this out.}

\pair{4. I am confused about the role of  $Stbl^+$ and $Enc$ in the proof system of the logic. These are important requirements for preservation of satisfaction. 
\\
However, it is not clear how they are connected to the rest of the proof system. I suspect this is through module well-formedness and its premise that Spec(M) is well-formed. But it is unclear if this is the case because this relation is not explained in the paper.}
{{\textbf{Thank you}} for pointing this out to us. 
\\
Upon further reflection we realized how crucial it is to explain these concepts well.
As a result, we expanded the discussion of $Stbl^+$ and $Enc$ in sections 4.3.1 and 4.3.2, and added Fig. 6 to demonstrate examples and differences.}

\pair{ 5. Some secondary parts of the formalism need a bit more fleshing out. Eg
\\ - the expression evaluation that first appears in def 6., is straightforward but there should be a sentence that explains it. 
\\	- the ghost fields and their role --- I cannot find an example in the main body of the paper where they are needed. }
{Ghost fields are not needed for our work; they are supported, because they are convenient. We wrote some more explanations about ghost-fields in lines 417-424,  discuss the rationale of ghost code in lines 420-425, and give an example where ghost fields are used in Appendix A.3.}

\pair{ 6. typos and grammatical errors}
{We have gone through the paper thoroughly and tried to remove all such errors.}

\pair{
7. ...  nomenclature used in 9 (scoped vs shallow) made things even worse in my mind.}
{Indeed, it was misleading nomenclature. We now talk of "deep" vs "shallow" satisfaction.\\
We have added explanations for what it means for a specification to be well-formed (and why the requirement needs to be made), and made a better bridge to the requirement for a proof of the method body of \texttt{Shop::buy}.\\
We also started the paragraph called “External Calls” with a discussion of proofs of method bodies.}

 
\end{document}
