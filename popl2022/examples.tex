\newpage

\section{Examples}
\label{s:examples}

\subsection{Bank Account w/ Password and Ghost Field}
We provide an implementation of \texttt{BankMdl} in Fig. \ref{f:ex-bank}.
\begin{figure}[t]
%      (PRE:  from == acc1 && to == acc2
%       POST: bal1$_\texttt{new}$ < bal1$_\texttt{old}$)
%      (PRE:  from == acc2 && to == acc1
%       POST: bal2$_\texttt{new}$ < bal2$_\texttt{old}$)
\begin{lstlisting}[mathescape=true, frame=lines]
module BankMdl
  class boundary Account
    field password : Object
    method authenticate(pwd)
      (PRE:  a : Account $\wedge$ b : Bank
       POST: b.getBalance(a)$_\texttt{old}$ == b.getBalance(a)$_\texttt{new}$)
      (PRE:  a : Account
       POST: res != a.password)
      (PRE:  a : Account
       POST: a.password$_\texttt{old}$ == a.password$_\texttt{new}$)
      {return pwd == this.password}
    method changePassword(pwd, newPwd)
      (PRE:  a : Account
       POST: res != a.password)
      (PRE:  a : Account $\wedge$ b : Bank
       POST: b.getBalance(a)$_\texttt{old}$ == b.getBalance(a)$_\texttt{new}$)
      (PRE:  a : Account $\wedge$ $\neg$ pwd == this.password
       POST: a.password$_\texttt{old}$ = a.password$_\texttt{new}$)
      {if pwd == this.password
        this.password := newPwd}

  class inside Ledger
    field acc1 : Account
    field bal1 : int
    field acc2 : Account
    field bal2 : int
    ghost intrnl getBalance(acc) = 
      if acc == acc1
        bal1
      else if acc == acc2
        bal2
      else -1
    method transfer(amt, from, to)
      (PRE:  a : Account $\wedge$ b : Bank $\wedge$ $\neg$ (a == acc1 $\wedge$ a == acc2)
       POST: b.getBalance(a)$_\texttt{old}$ == b.getBalance(a)$_\texttt{new}$)
      (PRE:  a : Account
       POST: res != a.password)
      (PRE:  a : Account
       POST: a.password$_\texttt{old}$ == a.password$_\texttt{new}$)
      {if from == acc1 && to == acc2
         bal1 := bal1 - amt
         bal2 := bal2 + amt
       else if from == acc2 && to == acc1
         bal1 := bal1 + amt
         bal2 := bal2 - amt}
      

  class boundary Bank
    field book : Ledger
    ghost intrnrl getBalance(acc) = book.getBalance(acc)
    method transfer(pwd, amt, from, to)
      (PRE:  a : Account $\wedge$ b : Bank $\wedge$ $\neg$ (a == acc1 $\wedge$ a == acc2)
       POST: b.getBalance(a)$_\texttt{old}$ a= b.getBalance(a)$_\texttt{new}$)
      (PRE:  a : Account
       POST: res != a.password)
      (PRE:  a : Account
       POST: a.password$_\texttt{old}$ == a.password$_\texttt{new}$)
      {if (from.authenticate(pwd))
         book.transfer(amt, from, to)}
\end{lstlisting}
\caption{Bank Account Module}
\label{f:ex-bank}
\end{figure}
We would need to prove \texttt{BankSpec}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankSpec1 $\triangleq$  b : Bank $\wedge$ b.getBalance(a) = bal 
%               to b.getbalance(a) $\neq$ bal
%               onlyIf $\exists$ o.[$\external{\texttt{o}}$ $\wedge$ $\access{\texttt{o}}{\texttt{a}}$]
%\end{lstlisting}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
BankSpec $\triangleq$  b : Bank $\wedge$ b.getBalance(a) = bal 
              to b.getbalance(a) < bal
              onlyIf $\exists$ o'.[$\external{\texttt{o'}}$ $\wedge$ $\access{\texttt{o'}}{\texttt{a.password}}$]
\end{lstlisting}
In order to do this, we need to prove the intermediate results \texttt{BalanceChange}, \texttt{PasswordChange}, and \texttt{PasswordLeak}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
BalanceChange $\triangleq$  a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal
                 to1 b.getBalance(a) < bal
                 onlyIf $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password}, \_, \texttt{a}, \_}$
\end{lstlisting}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
PasswordChange $\triangleq$  a : Account $\wedge$ a.password = p
                  to1 $\neg$ a.password $\neq$ p
                  onlyIf $\calls{\_}{\texttt{a}}{\texttt{changePassword}}{\texttt{a.password}, \_}$
\end{lstlisting}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
PasswordLeak $\triangleq$  a : Account $\wedge$ a.password = p $\wedge$ wrapped<p>
                  to1 $\neg$ wrapped<p>
                  onlyIf false
\end{lstlisting}
To prove these intermediate results, we make use of the classical specifications 
that we have annotated \texttt{BankMdl} with.
%Finally, in order construct the above proofs, we assume that \texttt{BankMdl} module 
%has the following traditional specifications.
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%%AccountIsNotLeakedByBank $\triangleq$ {a : Account $\wedge$ $\forall$ x.[$\internal{\texttt{x}}$ $\vee$ $\neg\access{\texttt{x}}{\texttt{a}}$]} 
%%                              BankMdl 
%%                           {a : Account $\wedge$ $\forall$ x.[$\internal{\texttt{x}}$ $\vee$ $\neg\access{\texttt{x}}{\texttt{a}}$]}
%%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%PasswordIsNotLeakedByBank $\triangleq$ {a : Account $\wedge$ $\forall$ x.[$\internal{\texttt{x}}$ $\vee$ $\neg\access{\texttt{x}}{\texttt{a.password}}$]} 
%                              BankMdl 
%                           {a : Account $\wedge$ $\forall$ x.[$\internal{\texttt{x}}$ $\vee$ $\neg\access{\texttt{x}}{\texttt{a.password}}$]}
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%TransferChangesBalance $\triangleq$ {a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ 
%                                 $\neg$ $\exists$ o.[$\calls{\texttt{o}}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password}, \_, \texttt{a}, \_}$]}
%                            BankMdl 
%                         {b.getBalance(a) = bal}
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%PasswordChange $\triangleq$ {a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ 
%                                 $\neg$ $\exists$ o.[$\calls{\texttt{o}}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password}, \_, \texttt{a}, \_}$]}
%                              BankMdl 
%                           {b.getBalance(a) = bal}
%\end{lstlisting}
%It is easy enough to see that both \texttt{AccountIsNotLeaked}, \texttt{PasswordIsNotLeaked}, and \texttt{TransferChangesBalance} are provable
%pre- and post-condition using traditional Hoare Logic.
\\
\newpage
sdfsdf
\newpage
\begin{minipage}{\textwidth}
{
	\begin{proofexample}
		\proofsteps{AuthBalChange}
			{\proofstepwithrule
				{\hoareEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a$^\prime$) = bal}
						{a.authenticate(pwd)}
						{b.getbalance(a$^\prime$) == bal}
						}
					{by classical spec.}
			}
			{\proofstepwithrule
				{\hoareEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a$^\prime$) = bal $\wedge$ $\neg$ false}
						{a.authenticate(pwd)}
						{$\neg$ b.getbalance(a$^\prime$) < bal}
						}
					{by classical Hoare logic}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a$^\prime$) = bal $\wedge$ $\calls{\_}{\texttt{a}}{\texttt{authenticate}}{\texttt{pwd}}$}
						{b.getbalance(a$^\prime$) < bal}
						{false}
						}
					{by \textsc{If1-Classical}}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a$^\prime$) = bal $\wedge$ $\calls{\_}{\texttt{a}}{\texttt{authenticate}}{\texttt{pwd}}$}
						{b.getbalance(a$^\prime$) < bal}
						{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a$^\prime$.password, amt, a$^\prime$, to}}$}
						}
					{by \textsc{Absurd} and \textsc{If1-}$\longrightarrow$}
			}
		\endproofsteps
	\end{proofexample}
}
\end{minipage}
{
	\begin{proofexample}
		\proofsteps{ChangePasswordBalChange}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{a : Account $\wedge$ a$^\prime$ : $\wedge$ b : Bank $\wedge$ b.getBalance(a$^\prime$) = bal $\wedge$ $\calls{\_}{\texttt{a}}{\texttt{changePassword}}{\texttt{pwd}}$}
						{b.getbalance(a$^\prime$) < bal}
						{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a$^\prime$.password, amt, a$^\prime$, to}}$}
						}
					{by similar reasoning to \textbf{AuthBalChange}}
			}
		\endproofsteps
	\end{proofexample}
}
{
	\begin{proofexample}
		\proofsteps{Ledger::TransferBalChange}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{l : Ledger $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\texttt{amt, from, to}}$}
						{b.getbalance(a) < bal}
						{$\calls{\_}{\texttt{l}}{\texttt{transfer}}{\texttt{amt, from, to}}$}
						}
					{by \textsc{If-Start} and \textsc{If1-If}}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{l : Ledger $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\texttt{amt, from, to}}$}
						{b.getbalance(a) < bal}
						{$\neg\wrapped{\texttt{l}}$}
						}
					{by \textsc{If1-}$\longrightarrow$, \textsc{Caller-Ext}, and \textsc{Caller-Recv}}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{l : Ledger $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\texttt{amt, from, to}}$}
						{b.getbalance(a) < bal}
						{\false}
						}
					{by \textsc{Intrnl-Wrapped} and \textsc{If1-}$\longrightarrow$}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{l : Ledger $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\texttt{amt, from, to}}$}
						{b.getbalance(a) < bal}
						{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password, amt, a, to}}$}
						}
					{by \textsc{Absurd} and \textsc{If1-}$\longrightarrow$}
			}
		\endproofsteps
	\end{proofexample}
}
{
	\begin{proofexample}
		\proofsteps{Bank::TransferBalChange}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{b$^\prime$ : Bank $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{b$^\prime$}}{\texttt{transfer}}{\texttt{pwd, amt, from, to}}$}
						{b.getbalance(a) < bal}
						{a == from $\wedge$ pwd == a.password $\wedge$ b$^\prime$ == b}
						}
					{by similar reasoning to \textbf{AuthBalChange}}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ $\calls{\_}{\texttt{b$^\prime$}}{\texttt{transfer}}{\texttt{pwd, amt, from, to}}$}
						{b.getbalance(a) < bal}
						{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password, amt, a, to}}$}
						}
					{by \textsc{If1-}$\longrightarrow$}
			}
		\endproofsteps
	\end{proofexample}
}
\begin{proofexample}
\proofsteps{\texttt{BalanceEncaps}}
	{\begin{proofexample}
		\proofsteps{\texttt{aIntrnl}}
			{\proofstepwithrule
			{$\proves{\texttt{BankMdl}}{\givenA{\texttt{b$^\prime$ : Bank $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}}{\intrnl{\texttt{a}}}}$}
				{by \textsc{Intrnl-Obj}}
		}
		\endproofsteps
	\end{proofexample}
		}
	{\begin{proofexample}
		\proofsteps{\texttt{bIntrnl}}
			{\proofstepwithrule
			{$\proves{\texttt{BankMdl}}{\givenA{\texttt{b$^\prime$ : Bank $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}}{\intrnl{\texttt{b}}}}$}
				{by \textsc{Intrnl-Obj}}
		}
		\endproofsteps
	\end{proofexample}
		}
	{\begin{proofexample}
		\proofsteps{\texttt{balIntrnl}}
			{\proofstepwithrule
			{$\proves{\texttt{BankMdl}}{\givenA{\texttt{b$^\prime$ : Bank $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}}{\intrnl{\texttt{b.getBalance(a)}}}}$}
				{by \texttt{aEncaps}, \texttt{bEncaps}, and \textsc{Intrnl-Ghost}}
		}
		\endproofsteps
	\end{proofexample}
		}
		{\proofstepwithrule
			{
			$\proves{\texttt{BankMdl}}{\givenA{\texttt{b$^\prime$ : Bank $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}}{\encaps{\texttt{b.getBalance(a)}}}}$
			}{by \texttt{balIntrnl}, \textsc{Enc-Intrnl}}}
\endproofsteps
\end{proofexample}
\begin{proofexample}
\proofsteps{\texttt{BalanceChange}}
	{\proofstepwithrule
			{\onlyIfSingleEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}
					{b.getbalance(a) < bal}
					{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password, amt, a, to}}$}
					}
				{by \textbf{AuthBalChange}, \textbf{ChangePasswordBalChange}, \textbf{Ledger::TransferBalChange}, \textbf{Bank::TransferBalChange}, \textbf{BalanceEncaps}, and \textsc{If1-Internal}}
		}
\endproofsteps
\end{proofexample}
\begin{proofexample}
\proofsteps{\texttt{PasswordChange}}
	{\proofstepwithrule{\onlyIfSingleEx
				{a : Account $\wedge$ a.password = p}
				{a.password $\neq$ p}
				{$\calls{\_}{\texttt{a}}{\texttt{changePassword}}{\texttt{p}, \_}$}
				}
			{by similar reasoning to \textbf{BalanceChange}}
	}
\endproofsteps
\end{proofexample}
\begin{proofexample}
\proofsteps{\texttt{PasswordLeak}}
	{
	\begin{proofexample}
		\proofsteps{AuthPwdLeak}
			{\proofstepwithrule
				{\hoareEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ a.password == pwd}
						{\texttt{res} = a$^\prime$.authenticate(\_)}
						{res != pwd}
						}
					{by classical spec.}
			}
			{\proofstepwithrule
				{\hoareEx
						{a : Account $\wedge$ a$^\prime$ : Account $\wedge$ a.password == pwd $\wedge$ $\neg$ false}
						{\texttt{res} = a$^\prime$.authenticate(\_)}
						{res != pwd}
						}
					{by classical Hoare logic}
			}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{$\wrapped{\texttt{pwd}}$ $\wedge$ a : Account $\wedge$ a$^\prime$ : Account $\wedge$ a.password = pwd $\wedge$ $\calls{\_}{\texttt{a}^\prime}{\texttt{authenticate}}{\_}$}
						{$\neg \wrapped{\_}$}
						{false}
						}
					{by \textsc{If1-Wrapped}}
			}
		\endproofsteps
	\end{proofexample}
	}
	{
	\begin{proofexample}
		\proofsteps{ChangePasswordLeak}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{$\wrapped{\texttt{pwd}}$ $\wedge$ a : Account $\wedge$ a$^\prime$ : Account $\wedge$ a.password = pwd $\wedge$ $\calls{\_}{\texttt{a}^\prime}{\texttt{changePassword}}{\_, \_}$}
						{$\neg \wrapped{\texttt{pwd}}$}
						{false}
						}
					{by similar reasoning to \textbf{AuthPwdLeak}}
			}
		\endproofsteps
	\end{proofexample}
	}
	{
	\begin{proofexample}
		\proofsteps{Ledger::TransferPwdLeak}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{$\wrapped{\texttt{pwd}}$ $\wedge$ a : Account $\wedge$ l : Ledger $\wedge$ a.password = pwd $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\_, \_, \_}$}
						{$\neg \wrapped{\texttt{pwd}}$}
						{false}
						}
					{by similar reasoning to \textbf{AuthPwdLeak}}
			}
		\endproofsteps
	\end{proofexample}
	}
	{
	\begin{proofexample}
		\proofsteps{Bank::TransferPwdLeak}
			{\proofstepwithrule
				{\onlyIfSingleEx
						{$\wrapped{\texttt{pwd}}$ $\wedge$ a : Account $\wedge$ b : Bank $\wedge$ a.password = pwd $\wedge$ $\calls{\_}{\texttt{l}}{\texttt{transfer}}{\_, \_, \_, \_}$}
						{$\neg \wrapped{\texttt{pwd}}$}
						{false}
						}
					{by similar reasoning to \textbf{AuthPwdLeak}}
			}
		\endproofsteps
	\end{proofexample}
	}
	{\proofstepwithrule{\onlyIfSingleEx
				{a : Account $\wedge$ a.password = p $\wedge$ $\wrapped{\texttt{p}}$}
				{$\neg \wrapped{\texttt{p}}$}
				{false}
				}
			{by \textsc{If1-Internal}, \textbf{AuthPwdLeak}, \textbf{ChangePasswordLeak}, \textbf{Ledger::TransferPwdLeak}, and \textbf{Bank::TransferPwdLeak}}
	}
\endproofsteps
\end{proofexample}

\begin{proofexample}
\proofsteps{\texttt{BankSpec}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}
				{b.getBalance(a) < bal}
				{$\calls{\_}{\texttt{b}}{\texttt{transfer}}{\texttt{a.password}, \_, \texttt{a}, \_}$}
				}
			{by \textsc{Changes} and \texttt{BalanceChange}}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal}
				{b.getBalance(a) < bal}
				{$\exists$ o.[$\external{\texttt{o}}$ $\wedge$ $\access{\texttt{o}}{\texttt{a.password}}$]}
				}
			{by $\longrightarrow$, \textsc{Caller-Ext}, and \textsc{Calls-Args}}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
				{b.getBalance(a) < bal}
				{$\neg$$\wrapped{\texttt{a.password}}$}
				}
			{by $\longrightarrow$}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
				{b.getBalance(a) < bal}
				{$\neg$$\wrapped{\texttt{a.password}}$ $\wedge$ (a.password = pwd $\vee$ a.password != pwd)}
				}
			{by $\longrightarrow$ and \textsc{Excluded Middle}}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
				{b.getBalance(a) < bal}
				{($\neg$$\wrapped{\texttt{a.password}}$ $\wedge$ a.password = pwd) $\vee$\\
				($\neg$$\wrapped{\texttt{a.password}}$ $\wedge$ a.password != pwd)}
				}
			{by $\longrightarrow$}}
	{\proofstepwithrule{\onlyThroughEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
				{b.getBalance(a) < bal}
				{$\neg$$\wrapped{\texttt{pwd}}$ $\vee$
				a.password != pwd}
				}
			{by $\longrightarrow$}}
	{
	\begin{proofexample}
	\proofsteps{Case A ($\neg\wrapped{\texttt{pwd}}$)}
			{\proofstepwithrule
				{\onlyIfEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
					{$\neg$$\wrapped{\texttt{pwd}}$}
					{$\wrapped{\texttt{pwd}}\ \vee \neg\wrapped{\texttt{pwd}}$}
					}
				{by \textsc{If-}$\longrightarrow$ and \textsc{Excluded Middle}}}
			{\proofstepwithrule{\onlyIfEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
					{$\neg$$\wrapped{\texttt{pwd}}$}
					{$\neg\wrapped{\texttt{pwd}}$}
					}
				{by $\vee$E and \texttt{PasswordLeak}}}
	\endproofsteps
	\end{proofexample}
	}
	{
	\begin{proofexample}
	\proofsteps{Case B (\texttt{a.password != pwd})}
		{\proofstepwithrule{\onlyThroughEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
					{a.password != pwd}
					{$\calls{\_}{\texttt{a}}{\texttt{changePassword}}{\texttt{pwd}, \_}$}
					}
				{by \textsc{Changes} and \textsc{PasswordChange}}}
		{\proofstepwithrule{\onlyThroughEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
					{a.password != pwd}
					{$\neg\wrapped{\texttt{pwd}}$}
					}
				{by $\vee$E and \texttt{PasswordLeak}}}
		{\proofstepwithrule{\onlyIfEx
					{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
					{a.password != pwd}
					{$\neg\wrapped{\texttt{pwd}}$}
					}
				{by \textbf{Case A} and \textsc{Trans}}}
	\endproofsteps
	\end{proofexample}
	}
	{\proofstepwithrule{\onlyIfEx
				{a : Account $\wedge$ b : Bank $\wedge$ b.getBalance(a) = bal $\wedge$ a.password = pwd}
				{b.getBalance(a) < bal}
				{$\neg\wrapped{\texttt{pwd}}$}
				}
			{by \textbf{Case A}, \textbf{Case B}, \textsc{If-}$\vee$I$_2$, and \textsc{If-}$\longrightarrow$}}
\endproofsteps
\end{proofexample}

\subsection{ERC20}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
ERC20Spec1 $\triangleq$  e : ERC20 $\wedge$ e.balance(p) = m + m'
              to1 e.balance(p) = m'
              onlyIf $\exists$ p', p''.[$\calls{\prg{p}}{\prg{e}}{\prg{transfer}}{\prg{p', m}}$ $\vee$ $\calls{\prg{p''}}{\prg{e}}{\prg{transferFrom}}{\prg{p', m}}$]
\end{lstlisting}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
ERC20Spec2 $\triangleq$  e : ERC20 $\wedge$ e.allowed(p, p') = m
              to1 e.balance(p) = m'
              onlyIf $\calls{\prg{p}}{\prg{e}}{\prg{approve}}{\prg{p', m}}$ $\vee$ 
                     (e.allowed(p, p') = m $\wedge$ 
                      $\neg$ ($\calls{\prg{p'}}{\prg{e}}{\prg{transferFrom}}{\prg{p, \_}}$ $\vee$ 
                              $\calls{\prg{p}}{\prg{e}}{\prg{allowed}}{\prg{p, \_}}$)) $\vee$
                     $\exists$ p''. [e.allowed(p, p') = m + m' $\wedge$ $\calls{\prg{p'}}{\prg{e}}{\prg{transferFrom}}{\prg{p'', m'}}$]
\end{lstlisting}

\subsection{DAO}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
DAOSpec1 $\triangleq$ d : DAO
            to d.balance(p) > d.ether
            onlyIf false
\end{lstlisting}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
DAOSpec2 $\triangleq$ d : DAO
            to1 d.balance(p) = m
            onlyIf $\calls{\prg{p}}{\prg{d}}{\prg{repay}}{\prg{\_}}$ $\wedge$ m = 0 $\vee$ $\calls{\prg{p}}{\prg{d}}{\prg{join}}{\prg{m}}$ $\vee$ d.balance(p) = m
\end{lstlisting}

\subsection{DOM}
\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
DOMSpec $\triangleq$ nd : Node $\wedge$ n.property = p
            to nd.property != p
            onlyIf $\exists$ o.[$\neg$ o : Node $\wedge$ $\neg$ o : Wrapper $\wedge$ 
                        ($\exists$ nd' : Node.[$\access{\prg{o}}{\prg{nd'}}$] $\vee$ 
                         $\exists$ w : Wrapper, k : $\mathbb{N}$.[$\access{\prg{o}}{\prg{w}}$ $\wedge$ nd.parnt$^{\prg{k}}$ = w.node.parnt$^{\prg{w.height}}$] )]
\end{lstlisting}







%\subsection{Bank Account 1 - Simple}
%\label{ex:bank1}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankSpec $\triangleq$  a : Account $\wedge$ a.balance = b to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ only if $\neg\ \encapsulated{\texttt{a}}$
%\end{lstlisting}
%We assume that the method \texttt{deposit} conforms to the following 
%specification
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%DepositSpec $\triangleq$  {a'.balance = b $\wedge$ a' $\neq$ a $\wedge$ a' $\neq$ from}
%					a.deposit(from, amt) 
%			   {a'.balance = b}
%\end{lstlisting}
%And all other methods \texttt{m} in \texttt{Account} conform to the 
%following spec
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%AccountMethSpec $\triangleq$  {a : Account $\wedge$ a.balance = b}
%					  a.m(...) 
%			       {a.balance = b}
%\end{lstlisting}
%From \texttt{DepositSpec} and \texttt{AccountMethSpec} we can derive \texttt{BASafety}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%BASafety $\triangleq$  a : Account $\wedge$ a.balance = b 
%            to a.balance != b
%            through Bank
%            onlyIf $\exists$ a'. [a' : Account $\wedge$ $\calls{\_}{\texttt{a'}}{\texttt{deposit}}{\texttt{a, \_}}$ $\vee$ $\calls{\_}{\texttt{a}}{\texttt{deposit}}{\texttt{a'},\_}$
%\end{lstlisting}
%Then we assume that all methods $m$ in \texttt{Account} observe the following specification:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%AccountEncapsulation $\triangleq$ {a : Account $\wedge$ $\encapsulated{\texttt{a}}$}
%				          a.m(...)
%				       {$\encapsulated{\texttt{a}}$}
%\end{lstlisting}
%And thus from \texttt{AccoutnEncapsulation} and Definition \ref{def:module_necessary} we can derive \texttt{BAEncapsulation}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BAEncapsulation $\triangleq$  a : Account $\wedge$ $\changes{\I}{\encapsulated{\texttt{a}}}$
%                 onlyIf false
%\end{lstlisting}
%%\begin{figure}[p]
%\begin{minipage}{\linewidth}
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame = single]
%a : Account $\wedge$ a.balance = b 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\changes{\texttt{\_}}{\texttt{a.balance = b}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ $\encapsulated{\texttt{a.balance}}$ 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\changes{\texttt{\_}}{\texttt{a.balance = b}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$ and \textsc{Encap-f}$_1s$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ $\encapsulated{\texttt{a.balance = b}}$ 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\changes{\I}{\texttt{a.balance = b}}$ $\vee$ 
%              $\changes{\I}{\encapsulated{\text{a.balance = b}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Write} and \textsc{Trans}$_1$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ $\encapsulated{\texttt{a.balance = b}}$ 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\changes{I}{\texttt{a.balance = b}}$ $\vee$ false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Int-f} and \textsc{Trans}$_3$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\scriptsize
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ $\encapsulated{\texttt{a.balance = b}}$ 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\changes{I}{\texttt{a.balance = b}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\vee$\textsc{E}$_1$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ $\encapsulated{\texttt{a.balance = b}}$ 
%  to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%  onlyThrough $\exists$ o.[$\access{\texttt{o}}{\texttt{a}}$ $\wedge$ $\external{\texttt{o}}$]
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Int-Changes}, \textsc{BASafety}, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame = none]
%ResultA $\triangleq$ a : Account $\wedge$ a.balance = b  
%            to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%            onlyThrough $\neg\encapsulated{\texttt{a}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\end{proofBox}
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ $\encapsulated{\texttt{a}}$ 
%  to $\neg\encapsulated{\texttt{a}}$
%  onlyThrough $\changes{\_}{\encapsulated{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ $\encapsulated{\texttt{a}}$ 
%  to $\neg\encapsulated{\texttt{a}}$
%  onlyThrough $\changes{I}{\encapsulated{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%ResultB $\triangleq$ a : Account $\wedge$ $\encapsulated{\texttt{a}}$ 
%  to $\neg\encapsulated{\texttt{a}}$ 
%  onlyThrough false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Int-Changes}, \textsc{BAEncapsulation}, and $\longrightarrow$
%\end{minipage}
%\end{proofBox}
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ a.balance = b $\wedge$ 
%  to $\neg\encapsulated{\texttt{a}}$ 
%  onlyIf $\encapsulated{\texttt{a}}$ $\vee$ $\neg\encapsulated{\texttt{a}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{If-True}, \textsc{Excluded Middle}, and \textsc{If}-$\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.balance = b $\wedge$ 
%  to $\neg\encapsulated{\texttt{a}}$  
%  onlyIf $\neg \encapsulated{\texttt{a}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{If}-$\vee$\textsc{E}$_1$ and \texttt{ResultB}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%Result $\triangleq$ a : Account $\wedge$ a.balance = b $\wedge$ 
%           to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%           onlyIf $\neg \encapsulated{\texttt{a}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{ResultA} and \textsc{If-Trans}
%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[mathescape=true, frame=none]
%%Result $\triangleq$ a : Account $\wedge$ a.balance = b $\wedge$ 
%%           to $\langle\ \neg$ a.balance $\neq$ b $\rangle$ 
%%           onlyIf $\neg \bencapsulated{\texttt{a}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by Lemma \ref{lem:behaveToTop}(\textsc{Read}) and $\longrightarrow$
%%\end{minipage}
%\end{proofBox}
%\end{minipage}
%%\end{figure} 
%
%\newpage
%
%\subsection{Bank Account 2 - No Leaking} 
%\label{ex:bank2}
%In this version of the Bank Account, we show that we 
%are able to reason about fairly complex forms of encapsulation.
%Specifically if some \texttt{Bank} \texttt{b} encapsulates
%some \texttt{Account} a, then it must follow that 
%the \texttt{Ledger} \texttt{l} that contains \texttt{a}
%is also encapsulated by \texttt{b}, and subsequently that any change to
%the balance of \texttt{a} requires a call to \texttt{transfer}
%on \texttt{b}. This is interesting because, while other examples
%do not provide a way to leak access to an account, this example 
%does, but only through the \texttt{Ledger} interface, and thus
%encapsulation of the \texttt{Ledger} is sufficient to ensure
%encapsulation of the account. Note, this example only proves 
%that leaking of an account is not possible, it does not prove 
%that encapsulation of an account is always assured under all 
%program states. Encapsulation of the account is shown in the
%example in Section \ref{ex:bank3}.
%\begin{lstlisting}[mathescape=true, frame=lines]
%module BankMdl
%  class Account
%    field bal : int
%    method transfer(to, amt)
%      this.bal := this.bal - amt
%      to.bal := to.bal + amt
%
%  class Ledger
%    field acc1 : Account
%    field acc2 : Account
%    method getAcc1()
%      return this.acc1
%    method getAcc2()
%      return this.acc2
%
%  class Bank
%    field accs : Ledger
%    method transfer(amt)
%      this.accs.getAcc1().transfer(this.accs.getAcc2(), amt)
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankSpec $\triangleq$ a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%             to a.bal $\neq$ x
%             onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%As with the example in Section \ref{ex:bank1}, we require 
%the \verb|Bank| module to prove several invariants:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%AccAccess $\triangleq$ a : Account $\wedge$ $\encapsulates{\texttt{B}}{\texttt{a}}$
%              to $\neg\encapsulates{\texttt{B}}{\texttt{a}}$
%              through BankMdl
%              onlyIf $\exists$ o, l. [ l : Ledger $\wedge$ ($\calls{\texttt{o}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%                                                 $\calls{\texttt{o}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)]
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BalChange $\triangleq$ a : Account $\wedge$ a.bal = x
%              to a.bal $\neq$ x
%              through BankMdl
%              onlyIf $\exists$ a' o. [a' : Account $\wedge$ $\external{\texttt{o}}$ $\wedge$ 
%                            ($\calls{\_}{\texttt{a}}{\texttt{transfer}}{\texttt{a'}, \_}$ $\vee$ $\calls{\_}{\texttt{a'}}{\texttt{transfer}}{\texttt{a}, \_}$)] $\vee$
%                     $\exists$ b. [b : Bank $\wedge$ $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$ $\wedge$ 
%                            (b.accs.acc1 = a $\vee$ b.accs.acc2 = a)])]
%\end{lstlisting}
%%We also need to prove a more general property of the encapsulation of account objects by bank objects.
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%%AccEncap1 $\triangleq$ b : Bank $\wedge$ ($\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\vee$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$)
%%              $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs}}$
%%\end{lstlisting}
%Finally we need to prove the following property:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankEncapUnique $\triangleq$ a : Account $\wedge$ b b' : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%                    (b'.accs.acc1 = a || b'.accs.acc2 = a)
%                    $\longrightarrow$ b' = b
%\end{lstlisting}
%
%
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%  $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%  $\changes{X_\texttt{\{b\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes}-$\longrightarrow$ and \textsc{Changes-Encap}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{AccAccess}, \textsc{Changes-Int}, and \textsc{Exists}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a) $\wedge$ $\external{\texttt{x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Calls-Ext/Int}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  x = this $\wedge$ $\access{\texttt{x}}{\texttt{l}}$ $\wedge$ $\access{\texttt{l}}{\texttt{a}}$ $\wedge$ $\external{\texttt{x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Calls-}\texttt{this} and \textsc{Calls-Recv}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%  ($\encapsulated{\texttt{l}}$ $\vee$ l $\in$ {b})
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-}\texttt{this}, \textsc{Encap-Access}, and \textsc{Encap-}$\cup$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ $\encapsulated{\texttt{l}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\vee$\textsc{E}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%  ($\encapsulated{\texttt{this}}$ $\vee$ this $\in$ $\I$)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Access}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%  false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%ResultA $\triangleq$ a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%            $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$ $\longrightarrow$ false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\end{minipage}
%\end{proofBox}
%
%
%%\begin{proofBox}{white}{black}
%%\footnotesize
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg \encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Changes}
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ $\changes{X_\texttt{\{b\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Changes}-$\longrightarrow$, \textsc{Changes-Encap} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%%                  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%%                   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \texttt{AccAccess}, \textsc{Changes-Int}, \textsc{Exists}, and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%%                  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%%                   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a) $\wedge$ $\external{\texttt{x}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Calls-Ext/Int} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ x = this $\wedge$
%%                  $\access{\texttt{x}}{\texttt{l}}$ $\wedge$ $\access{\texttt{l}}{\texttt{a}}$ $\wedge$ $\external{\texttt{x}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Calls-}\texttt{this}, \textsc{Calls-Recv} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%%                  ($\encapsulated{\texttt{l}}$ $\vee$ l $\in$ {b})
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Encap-}\texttt{this}, \textsc{Encap-Access}, \textsc{Encap-}$\cup$, and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%%                  $\encapsulated{\texttt{l}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%%                  ($\encapsulated{\texttt{this}}$ $\vee$ this $\in$ $\I$)
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Encap-Access} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%%ResultA $\triangleq$ a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough false
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by $\longrightarrow$
%%\end{minipage}
%%\end{proofBox}
%
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\changes{\_}{\texttt{a.bal = x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%     ($\changes{X_{\{\texttt{b}\}}}{\texttt{a.bal = x}}$ $\vee$ $\changes{X_{\{\texttt{b}\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Write} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ $\changes{\I}{\texttt{a.bal = x}}$ $\vee$ false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{ResultA}, \textsc{Encap-}$\cup$, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              $\exists$ a' o. [a' : Account $\wedge$ $\external{\texttt{o}}$ $\wedge$ 
%                          ($\calls{\texttt{o}}{\texttt{a}}{\texttt{transfer}}{\texttt{a'}, \_}$ $\vee$ 
%                           $\calls{\texttt{o}}{\texttt{a'}}{\texttt{transfer}}{\texttt{a}, \_}$)] $\vee$
%              $\exists$ b'. [b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%                      (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])]
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{BalChange}, \textsc{Changes-Int}, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              ($\external{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{a}}$) $\vee$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Exists}, \textsc{Calls-Recv}, \textsc{Calls-Args}, \textsc{Calls-}\texttt{this}, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              ($\encapsulates{\texttt{b}}{\texttt{this}}$ $\vee$ this $\in$ {b}) $\vee$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Access}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-}\texttt{this} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              b' = b
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{BankEncapUnique} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%Result $\triangleq$ a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%           to a.bal $\neq$ x
%           onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\end{proofBox}
%
%\newpage
%
%\subsection{Bank Account 3 - General Encapsulation  of Accounts}
%\label{ex:bank3}
%Ideally we would like the encapsulation of accounts to arise from the definition of \texttt{Bank},
%and not have to provide it as a precondition to our robustness property. A preferable holistic 
%specification to \texttt{Bank} would be:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankSpec $\triangleq$ b : Bank $\wedge$ b.accs.acc1.bal = x $\wedge$ b : Bank
%             to b.accs.acc1.bal $\neq$ x
%             onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%That is, under all possible program configurations, the balance of an 
%account can only be modified using the \texttt{Bank} interface, i.e.
%encapsulation of the \texttt{Account} by the \texttt{Bank} is implicit.
%Unfortunately this proof is not possible using the \texttt{Bank} as defined
%in Section \ref{ex:bank2} because there is no way to ensure encapsulation
%of the \texttt{Account} by the \texttt{Bank} when the \texttt{Bank} is 
%created. For this we need to specify how \texttt{Bank}s and \texttt{Account}s are created.
%\begin{lstlisting}[mathescape=true, frame=lines]
%class Account {
%  field bal : int
%  constr (amt)
%    this.bal := amt
%  method transfer(to, amt)
%    this.bal := this.bal - amt
%    to.bal := to.bal + amt
%}
%class Ledger {
%  field acc1 : Account
%  field acc2 : Account
%  constr (amt1, amt2)
%    this.acc1 := new Account(amt1)
%    this.acc2 := new Account(amt2)
%  method getAcc1()
%    return this.acc1
%  method getAcc2()
%    return this.acc2
%}
%class Bank {
%  field accs : Ledger
%  constr (amt1, amt2)
%    this.accs := new Ledger(amt1, amt2)
%  method transfer(amt){
%    this.accs.getAcc1().transfer(this.accs.getAcc2(), amt)
%  }
%}
%\end{lstlisting}
%We also need to a proof rule that allows us to prove program invariants.
%\begin{mathpar}
%\infer
%		{
%		M;\ M',\ \sigma\ \vdash\ \exists o.[o : \texttt{Object}\ \wedge\ \forall o'.[o' = o]]\ \longrightarrow\ A\\
%		M;\ M',\ \sigma\ \vdash\ \onlyThrough{A}{\neg A}{\texttt{false}}
%		}
%		{
%		M;\ M',\ \sigma\ \vdash\ A
%		}
%		\quad(\textsc{Invariant})
%\end{mathpar}
%It is quite simple to prove the following property:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%$\exists$ o.[o : Object $\wedge$ $\forall$ o'.[o' = o]] $\longrightarrow$ $\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$]
%\end{lstlisting}
%Now we can use the above rule to demonstrate that given the appropriate
%traditional specifications on the methods on \texttt{BankMdl} (including the constructors), 
%$\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ and $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$ 
%are program invariants. i.e. \texttt{BankMdl} must use traditional specifications to 
%prove the following about all methods in \texttt{Bank}, \texttt{Ledger}, and \texttt{Account}:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%{$\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$]}
%  _.m(...)
%{$\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$]}
%\end{lstlisting}
%With this we can prove the following internal module invariant for \texttt{BankMdl}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankEncap $\triangleq$ $\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$
%              to $\neg\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$
%              through BankMdl
%              onlyIf false
%\end{lstlisting}
%
%Now we can construct a proof of \texttt{BankSpec}. We will re-use the results from Section \ref{ex:bank2} 
%as the proofs are much the same.
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$
%  to $\neg$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$
%  onlyThrough $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$
%  to $\neg$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$
%  onlyThrough false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{ResultA} (from Section \ref{ex:bank1}) and \textsc{Trans}$_1$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%EncapInv $\triangleq$ $\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$]
%             to $\neg$ $\forall$ b.[b : Bank $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$]
%             onlyThrough false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by {\color{red}Julian: We need some rule to extend quantification across the whole statement. Shouldn't be too hard ...}
%\end{minipage}
%\end{proofBox}
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%b : Bank $\wedge$ a : Account $\wedge$ b.acc.acc1 = a $\wedge$ a.bal = x $\wedge$ 
%  $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{Result}(Section \ref{ex:bank2}) and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%b : Bank $\wedge$ b.acc.acc1.bal = x $\wedge$ $\encapsulates{\texttt{b}}{\texttt{b.acc.acc1}}$
%  to b.acc.acc1.bal $\neq$ x
%  onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%Bank3Result $\triangleq$ b : Bank $\wedge$ b.acc.acc1.bal = x
%                to b.acc.acc1.bal $\neq$ x
%                onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Invariant}, \texttt{EncapInv}, and $\longrightarrow$
%\end{minipage}
%\end{proofBox}
%
%\newpage
%
%
%
%\subsection{Bank Account 4 - Ghost Field Balance {\color{red}(Julian: still working on this)}} 
%\label{ex:bank4}
%In this version of the Bank Account, we show that we 
%are able to reason about fairly complex forms of encapsulation.
%Specifically if some \texttt{Bank} \texttt{b} encapsulates
%some \texttt{Account} a, then it must follow that 
%the \texttt{Ledger} \texttt{l} that contains \texttt{a}
%is also encapsulated by \texttt{b}, and subsequently that any change to
%the balance of \texttt{a} requires a call to \texttt{transfer}
%on \texttt{b}. This is interesting because, while other examples
%do not provide a way to leak access to an account, this example 
%does, but only through the \texttt{Ledger} interface, and thus
%encapsulation of the \texttt{Ledger} is sufficient to ensure
%encapsulation of the account. Note, this example only proves 
%that leaking of an account is not possible, it does not prove 
%that encapsulation of an account is always assured under all 
%program states. Encapsulation of the account is shown in the
%example in Section \ref{ex:bank3}.
%\begin{lstlisting}[mathescape=true, frame=lines]
%module BankMdl
%  class Account
%
%  class Ledger
%    field acc : Account
%    field balance : int
%    field tail : Ledger
%    method addToBalance(amt)
%      if a == this.acc
%        this.balance := this.balance + amt
%    method find(a)
%      if a == this.acc
%        return this
%      else if this.tail == null
%        return null
%      else
%        return this.tail.find(a)
%    ghost balance(a)
%      if this.acc == a
%        return balance
%      else if this.tail == null
%        return -1
%      else 
%        return tail.balance(a)
%
%  class Bank
%    field accs : Ledger
%    
%    method transfer(from, to, amt)
%      dest := this.accs.find(from);
%      src := this.accs.find(to);
%      if dest != null && src != null && amt >= 0
%        dest.addToBalance(amt)
%        src.addToBalance(-1 * amt)
%        
%    ghost balance(acc) 
%      this.accs.balance(acc)
%      
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankSpec $\triangleq$ a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%             to a.bal $\neq$ x
%             onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%As with the example in Section \ref{ex:bank1}, we require 
%the \verb|Bank| module to prove several invariants:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%AccAccess $\triangleq$ a : Account $\wedge$ $\encapsulates{\texttt{B}}{\texttt{a}}$
%              to $\neg\encapsulates{\texttt{B}}{\texttt{a}}$
%              through BankMdl
%              onlyIf $\exists$ o, l. [ l : Ledger $\wedge$ ($\calls{\texttt{o}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%                                                 $\calls{\texttt{o}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)]
%\end{lstlisting}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BalChange $\triangleq$ a : Account $\wedge$ a.bal = x
%              to a.bal $\neq$ x
%              through BankMdl
%              onlyIf $\exists$ a' o. [a' : Account $\wedge$ $\external{\texttt{o}}$ $\wedge$ 
%                            ($\calls{\_}{\texttt{a}}{\texttt{transfer}}{\texttt{a'}, \_}$ $\vee$ $\calls{\_}{\texttt{a'}}{\texttt{transfer}}{\texttt{a}, \_}$)] $\vee$
%                     $\exists$ b. [b : Bank $\wedge$ $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$ $\wedge$ 
%                            (b.accs.acc1 = a $\vee$ b.accs.acc2 = a)])]
%\end{lstlisting}
%%We also need to prove a more general property of the encapsulation of account objects by bank objects.
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%%AccEncap1 $\triangleq$ b : Bank $\wedge$ ($\encapsulates{\texttt{b}}{\texttt{b.accs.acc1}}$ $\vee$ $\encapsulates{\texttt{b}}{\texttt{b.accs.acc2}}$)
%%              $\longrightarrow$ $\encapsulates{\texttt{b}}{\texttt{b.accs}}$
%%\end{lstlisting}
%Finally we need to prove the following property:
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=lines]
%BankEncapUnique $\triangleq$ a : Account $\wedge$ b b' : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%                    (b'.accs.acc1 = a || b'.accs.acc2 = a)
%                    $\longrightarrow$ b' = b
%\end{lstlisting}
%
%
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%  $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%  $\changes{X_\texttt{\{b\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes}-$\longrightarrow$ and \textsc{Changes-Encap}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{AccAccess}, \textsc{Changes-Int}, and \textsc{Exists}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a) $\wedge$ $\external{\texttt{x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Calls-Ext/Int}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  x = this $\wedge$ $\access{\texttt{x}}{\texttt{l}}$ $\wedge$ $\access{\texttt{l}}{\texttt{a}}$ $\wedge$ $\external{\texttt{x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Calls-}\texttt{this} and \textsc{Calls-Recv}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%  ($\encapsulated{\texttt{l}}$ $\vee$ l $\in$ {b})
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-}\texttt{this}, \textsc{Encap-Access}, and \textsc{Encap-}$\cup$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ $\encapsulated{\texttt{l}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\vee$\textsc{E}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%  ($\encapsulated{\texttt{this}}$ $\vee$ this $\in$ $\I$)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Access}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$
%  $\external{\texttt{this}}$ $\wedge$ $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%  false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%ResultA $\triangleq$ a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%            $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$ $\longrightarrow$ false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\end{minipage}
%\end{proofBox}
%
%
%%\begin{proofBox}{white}{black}
%%\footnotesize
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg \encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\changes{\_}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Changes}
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ $\changes{X_\texttt{\{b\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Changes}-$\longrightarrow$, \textsc{Changes-Encap} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%%                  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%%                   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a)
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \texttt{AccAccess}, \textsc{Changes-Int}, \textsc{Exists}, and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ 
%%                  ($\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc1}}{}$ $\wedge$ l.acc1 = a $\vee$ 
%%                   $\calls{\texttt{x}}{\texttt{l}}{\texttt{getAcc2}}{}$ $\wedge$ l.acc2 = a) $\wedge$ $\external{\texttt{x}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Calls-Ext/Int} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ x = this $\wedge$
%%                  $\access{\texttt{x}}{\texttt{l}}$ $\wedge$ $\access{\texttt{l}}{\texttt{a}}$ $\wedge$ $\external{\texttt{x}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Calls-}\texttt{this}, \textsc{Calls-Recv} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%%                  ($\encapsulated{\texttt{l}}$ $\vee$ l $\in$ {b})
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Encap-}\texttt{this}, \textsc{Encap-Access}, \textsc{Encap-}$\cup$, and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{l}}$ $\wedge$ 
%%                  $\encapsulated{\texttt{l}}$
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true]
%%a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough $\encapsulated{\texttt{a}}$ $\wedge$ l : Ledger $\wedge$ $\external{\texttt{this}}$ $\wedge$
%%                  $\neg \encapsulated{\texttt{this}}$ $\wedge$ $\encapsulated{\texttt{l}}$ $\wedge$
%%                  ($\encapsulated{\texttt{this}}$ $\vee$ this $\in$ $\I$)
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by \textsc{Encap-Access} and $\longrightarrow$
%%\end{minipage}
%%\begin{minipage}{0.75\textwidth}
%%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=none]
%%ResultA $\triangleq$ a : Account $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%%  to $\neg\encapsulates{\texttt{b}}{\texttt{a}}$
%%  onlyThrough false
%%\end{lstlisting}
%%\end{minipage}
%%\begin{minipage}{0.24\textwidth}
%%\scriptsize
%%\hfill by $\longrightarrow$
%%\end{minipage}
%%\end{proofBox}
%
%
%\begin{proofBox}{white}{black}
%\footnotesize
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true, frame=single]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\changes{\_}{\texttt{a.bal = x}}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Changes} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%     ($\changes{X_{\{\texttt{b}\}}}{\texttt{a.bal = x}}$ $\vee$ $\changes{X_{\{\texttt{b}\}}}{\encapsulates{\texttt{b}}{\texttt{a}}}$)
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Write} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ $\changes{\I}{\texttt{a.bal = x}}$ $\vee$ false
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{ResultA}, \textsc{Encap-}$\cup$, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              $\exists$ a' o. [a' : Account $\wedge$ $\external{\texttt{o}}$ $\wedge$ 
%                          ($\calls{\texttt{o}}{\texttt{a}}{\texttt{transfer}}{\texttt{a'}, \_}$ $\vee$ 
%                           $\calls{\texttt{o}}{\texttt{a'}}{\texttt{transfer}}{\texttt{a}, \_}$)] $\vee$
%              $\exists$ b'. [b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%                      (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])]
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{BalChange}, \textsc{Changes-Int}, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              ($\external{\texttt{this}}$ $\wedge$ $\access{\texttt{this}}{\texttt{a}}$) $\vee$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Exists}, \textsc{Calls-Recv}, \textsc{Calls-Args}, \textsc{Calls-}\texttt{this}, and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$ 
%              ($\encapsulates{\texttt{b}}{\texttt{this}}$ $\vee$ this $\in$ {b}) $\vee$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-Access}
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              (b'.accs.acc1 = a $\vee$ b'.accs.acc2 = a)])
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \textsc{Encap-}\texttt{this} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%  to a.bal $\neq$ x
%  onlyThrough $\encapsulates{\texttt{b}}{\texttt{a}}$ $\wedge$
%              b' : Bank $\wedge$ $\calls{\_}{\texttt{b'}}{\texttt{transfer}}{\_}$ $\wedge$ 
%              b' = b
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by \texttt{BankEncapUnique} and $\longrightarrow$
%\end{minipage}
%\begin{minipage}{0.75\textwidth}
%\begin{lstlisting}[language = Chainmail, mathescape=true]
%Result $\triangleq$ a : Account $\wedge$ a.bal = x $\wedge$ b : Bank $\wedge$ $\encapsulates{\texttt{b}}{\texttt{a}}$
%           to a.bal $\neq$ x
%           onlyThrough $\calls{\_}{\texttt{b}}{\texttt{transfer}}{\_}$
%\end{lstlisting}
%\end{minipage}
%\begin{minipage}{0.24\textwidth}
%\scriptsize
%\hfill by $\longrightarrow$
%\end{minipage}
%\end{proofBox}