%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[acmsmall,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[acmsmall]{acmart}\settopmatter{}


%% Journal information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{CONF} % CONF = POPL or ICFP or OOPSLA
\acmArticle{1}
\acmYear{2022}
\acmMonth{1}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%% Note: author/year citations are required for papers published as an
%% issue of PACMPL.
\citestyle{acmauthoryear}   %% For author/year citations


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from PACMPL format to traditional
%% SIGPLAN proceedings format must update the '\documentclass' and
%% topmatter commands above; see 'acmart-sigplanproc-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption
                        

\usepackage{relsize}
\usepackage{mathpartir}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{xspace}
\usepackage{definitions}
\usepackage{multirow,bigdelim}
\usepackage{pbox}
\usepackage{courier}

\newcommand\multibrace[3]{\rdelim\}{#1}{3mm}[\pbox{#2}{#3}]}

\newcommand{\kjx}[1]{#1}
\newcommand{\scd}[1]{#1}
%\newcommand{\sdN}[1]{{\color{dkgreen}{#1}}}
%\newcommand{\jm}[1]{{\color{magenta}{JM: #1}}}
\newcommand{\sdcomment}[1]{{\ensuremath{\blacksquare}}\footnote{\color{dkgreen}{SD: #1}}}
\newcommand{\secomment}[1]{{\ensuremath{\blacksquare}}\footnote{\se{#1}}}
\newcommand{\jncomment}[1]{{\ensuremath{\blacksquare}}\footnote{\kjx{#1}}}

\newcommand{\sd}[1]{{{#1}}}
 \newcommand{\tobyM}[1]{#1} %[1]{{\color{purple}{Toby: #1}}}
\newcommand{\se}[1]{#1} %{{\color{green}{#1}}}


\newcommand{\ponders}[3]{\marginpar{\tiny\itshape\raggedright\textcolor{#2}{\textbf{#1:} #3}}\ignorespaces}
\marginparwidth=1.6cm \marginparsep=0cm
\newcommand{\TODO}[1]{} % {{\color{red}#1}}
\newcommand{\sophia}[1]{} % {#1} % {{\color{red}#1}}
\newcommand{\toby}[1]{} % {\ponders{Toby}{purple}{#1}}
\newcommand{\susan}[2][]{#2} %{\ponders{Susan}{blue}{#1} \textcolor{teal}{#2}\xspace}
\newcommand{\james}[1]{} % {\ponders{James}{orange}{#1}}
\newcommand{\jm}[2][]{#2}
\newcommand{\mrr}[2][]{\ponders{Matthew Ross}{offblue}{{#1}} \textcolor{offblue}{{#2}}\xspace}
\newcommand{\mrrz}[1]{\textcolor{offblue}{{#1}}\xspace}
\newcommand{\Mrr}[2][]{\ponders{Matthew Ross}{teal}{{#1}} \textcolor{teal}{{#2}}\xspace}
\newcommand{\Mrrz}[1]{\textcolor{teal}{{#1}}\xspace}



\newcommand{\sophiaPonder}[2][]{{#2}}
\renewcommand{\sophia}[2][]


\begin{document}

%% Title information
%\title[Specification and Proof of Necessary Conditions]{Specification
%and Proof of Necessary Conditions}         %% [Short Title] is
%optional;
\title{Necessity Specifications are Necessary}
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Subtitle}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{First1 Last1}
\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position1}
  \department{Department1}              %% \department is recommended
  \institution{Institution1}            %% \institution is required
  \streetaddress{Street1 Address1}
  \city{City1}
  \state{State1}
  \postcode{Post-Code1}
  \country{Country1}                    %% \country is recommended
}
\email{first1.last1@inst1.edu}          %% \email is recommended

%% Author with two affiliations and emails.
\author{First2 Last2}
\authornote{with author2 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position2a}
  \department{Department2a}             %% \department is recommended
  \institution{Institution2a}           %% \institution is required
  \streetaddress{Street2a Address2a}
  \city{City2a}
  \state{State2a}
  \postcode{Post-Code2a}
  \country{Country2a}                   %% \country is recommended
}
\email{first2.last2@inst2a.com}         %% \email is recommended
\affiliation{
  \position{Position2b}
  \department{Department2b}             %% \department is recommended
  \institution{Institution2b}           %% \institution is required
  \streetaddress{Street3b Address2b}
  \city{City2b}
  \state{State2b}
  \postcode{Post-Code2b}
  \country{Country2b}                   %% \country is recommended
}
\email{first2.last2@inst2b.org}         %% \email is recommended


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
Traditional specifications deal in the sufficient conditions for
closed programs to be correct --- if a function is invoked with valid
preconditions, it will meet its post-conditions upon return: calling a
function will make good things happen.
%
Unfortunately, sufficient
conditions are insufficient for reasoning about
%open
programs in an
open world --- frameworks that can be extended, systems that interact
with third parties, programs subject to unintentional or
%even
malicious attacks.
%
In an open world, necessity specifications are
necessary: programmers need to reason about  necessary conditions
to prove that bad things can never happen.
%
The Logic of Necessity enables programmers to assert and to reason about the
necessary conditions for their programs to be correct, and to infer
the necessary conditions that their programs do (or do not) support. 
%
Using this logic, programmers can prove that bad things
do not happen, defending programs against an unfriendly open world.
\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10011007.10011006.10011008</concept_id>
<concept_desc>Software and its engineering~General programming languages</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10003456.10003457.10003521.10003525</concept_id>
<concept_desc>Social and professional topics~History of programming languages</concept_desc>
<concept_significance>300</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~General programming languages}
%\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
%%%%%%%%%%%%%%%%%%%%%\keywords{keyword1, keyword2, keyword3}  %% \keywords are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\input{introduction}

%\input{bankAccount}

\input{approach}

\input{semantics}

\input{expressive}

\input{inference}

\input{examples}



%\section{Discussion}

\input{related}

\input{conclusion}




%\section{Encapsulation - Old}
%We define two forms of encapsulation: (1) encapsulation of sets of objects by sets of objects (topological encapsulation), and (2) encapsulation of assertions by sets of objects (behavioral encapsulation).
%
%The first form of encapsulation is easiest to define, is topological in nature, and refers to which 
%objects refer to which other objects in the heap. We use the syntax $\encapsulates{B}{I}$
%for topological encapsulation. We define this form of encapsulation as a \Chainmail predicate in Def. \ref{def:tencap}.
%\begin{definition}[Topological Encapsulation]
%\label{def:tencap}
%$$\encapsulates{B}{I}\ \equiv\ \forall x,\ y.[y\ \in\ I\ \wedge\ 
%                                                                                                               (x\ \in\ B \cup I\ \vee\ 
%                                                                                                               \neg\access{x}{y})]\ \wedge\ 
%                                                                               \texttt{this}\ \not\in\ B \cup I$$
%\end{definition}
%That is, for any program state where the current 
%computation is occurring externally to the subset of the heap defined by $B \cup I$, 
%we say $\encapsulates{B}{I}$ if all objects external to $B$ and $I$ do not have access
%to any objects in $I$.
%We can use Def. \ref{def:tencap} to extend our notion of topological
%encapsulation to include objects and field accesses. We do this in Def. \ref{def:oencap} and \ref{def:fencap}.
%\begin{definition}[Topological Object Encapsulation]
%\label{def:oencap}
%$$\encapsulates{B}{x}\ \equiv\ \exists I.[\encapsulates{B}{I}\ \wedge\ x \in I]$$
%\end{definition}
%\begin{definition}[Topological Field Encapsulation]
%\label{def:fencap}
%$$\encapsulates{B}{x.f}\ \equiv\ \encapsulates{B}{x}\ \vee\ x \in B$$
%\end{definition}
%
%The second form of encapsulation refers to a behavioral property, and has the form 
%$\bencapsulates{B}{A}$, and informally means that any computation that results in a 
%change to $A$ requires a prior interaction with an object in $B$. Formally we define 
%the semantics in Definition Def. \ref{def:bencap}.
%\begin{definition}[Behavioral Encapsulation]
%\label{def:bencap}
%$\forall$ $M$, $M'$, $\sigma$, $B$, and $A$, \\
%$M;\ M',\ \sigma\ \vDash\ \bencapsulates{B}{A}$ iff
%$\forall$ $\sigma'$ such that
%\begin{itemize}
%\item
%$\sigma = \sigma'$ or $M;\ M',\ \sigma\ \leadsto^*\ \sigma'$ and
%\item
%$M;\ M',\ \sigma'\ \vDash\ \changes{\_}{A}$
%\end{itemize}
%then it follows that $\exists$ $\sigma''$ such that
%\begin{itemize}
%\item
%either
%\begin{itemize}
%\item
%$\sigma = \sigma''$ or 
%\item
%$M \circ M',\ \sigma\ \leadsto^*\ \sigma''$ and
%$M \circ M',\ \sigma''\ \leadsto^*\ \sigma'$
%\end{itemize}
%and
%\item
%either
%\begin{itemize}
%\item
%$\sigma''$.(\texttt{contn}) = \texttt{\_ := b.m(...)} and $\texttt{b}\ \in\ B$ or
%\item
%$\sigma''$.(\texttt{contn}) = \texttt{\_ := b.f} and $\texttt{b}\ \in\ B$ or
%\item
%$\sigma''$.(\texttt{contn}) = \texttt{b.f := \_} and $\texttt{b}\ \in\ B$
%\end{itemize}
%\end{itemize}
%\end{definition}
%
%
%The connection between our topological and behavioral definitions of encapsulation is
%interesting. The assertions that might be behaviorally encapsulated by a s	et $B$ include
%those assertions that are dependent on objects that are either in $B$, or encapsulated 
%by $B$. More specifically, $\bencapsulates{B}{A}$ if satisfaction of $A$ is dependent 
%on either a read or a write of data that is topologically encapsulated by $B$.
%We now formalize this relationship between Behavioral Encapsulation and Topological Encapsulation in Lemma \ref{lem:behaveToTop}.
%\begin{lemma}[Topological Encapsulation implies Behavioral Encapsulation]
%\label{lem:behaveToTop}
%For modules $M$ and $M'$, program configuration $\sigma$, set $B$, and assertion $A$ we have
%\begin{itemize}
%\item
%(\textsc{Read}):
%$\forall\ x,\ y$ if $M;\ M,'\ \sigma \vDash\ \changes{\_}{\neg\access{x}{y}}\ \longrightarrow\ \changes{\_}{A}$ then
%$$M;\ M,'\ \sigma \vDash\ \encapsulates{B}{y}\ \longrightarrow\ \bencapsulates{B}{A}$$ and
%\item
%(\textsc{Write}):
%$\forall\ x,\ f,\ y$ if $M;\ M',\ \sigma \vDash\ \changes{\_}{x.f = y}\ \longrightarrow\ \changes{\_}{A}$ 
%$$M;\ M',\ \sigma \vDash\ \encapsulates{B}{x.f}\ \longrightarrow \bencapsulates{B}{A}$$
%\end{itemize}
%%or put as a single \Chainmail assertion
%%$$M;\ M',\ \sigma\ \vDash\ (\encapsulates{B}{x.f} \wedge (x.f = y \longrightarrow A))\ \vee\ 
%%(\encapsulates{B}{y} \wedge (\neg \access{x}{y} \longrightarrow A))
%%\longrightarrow \bencapsulates{B}{A}$$
%\end{lemma}
%%\begin{lemma}[Topological Encapsulation implies Behavioral Encapsulation]
%%\label{lem:behaveToTop}
%%For modules $M$ and $M'$, program configuration $\sigma$, set $B$, and assertion $A$ we have
%%\begin{itemize}
%%\item
%%(\textsc{Read}):
%%$\forall\ x,\ y$ $M;\ M,'\ \sigma \vDash\ \encapsulates{B}{y}\ \longleftrightarrow\ \bencapsulates{B}{\neg \access{x}{y}}$ and
%%\item
%%(\textsc{Write}):
%%$\forall\ x,\ f,\ y$ $M;\ M',\ \sigma \vDash\ \encapsulates{B}{x.f}\ \longleftrightarrow \bencapsulates{B}{x.f = y}$
%%\end{itemize}
%%%or put as a single \Chainmail assertion
%%%$$M;\ M',\ \sigma\ \vDash\ (\encapsulates{B}{x.f} \wedge (x.f = y \longrightarrow A))\ \vee\ 
%%%(\encapsulates{B}{y} \wedge (\neg \access{x}{y} \longrightarrow A))
%%%\longrightarrow \bencapsulates{B}{A}$$
%%\end{lemma}
%That is any write to fields/read from objects encapsulated by 
%$B$ implies that any assertion $A$ dependent on that write/read is behaviorally 
%encapsulated by $B$, i.e. $\bencapsulates{B}{A}$.
%It is important to note that there are assertions that are behaviorally encapsulated
%by some set $B$ that are not related to either reads or writes (i.e. the calling of some private but pure method might be dependent on some external call to $B$).
%
%It is also useful to note that if $\encapsulates{B}{I}$, then while we know that 
%any operation that reads from/writes to $I$ necessitates an interaction with $B$,
%it does not necessarily require computation by an object in $B$. Specifically, 
%in $\mathcal{L}_\text{oo}$ this refers to a broader set that includes any objects
%that share a class with an object in $B$. Thus, for any boundary set $B$, we are 
%able to define a modifying set of objects of which some element of is required to 
%perform some computation to read from/write to any object/field encapsulated by 
%$B$. In $\mathcal{L}_\text{oo}$ that set is defined in Def. \ref{def:modSet}
%\begin{definition}[Modifying Set]
%\label{def:modSet}
%For set $B$, we define the modifying set of $B$ as
%$$X_B \equiv\ \{x\ |\ \exists y,\ C.[y\ \in\ B\ \wedge\ y : C\ \wedge\ x : C]\}$$
%\end{definition}
%Def \ref{def:modSet} is language dependent. In $\mathcal{L}_\text{oo}$ $X_B$ refers to
%those objects that share a class with a member of $B$, 
%but other languages, this might refer some other set of objects.
%
%We also define the set of all internal objects in Def. \ref{def:intSet} along with 
%the subset relation in Def. \ref{def:subset}
%\begin{definition}[Internal Set]
%\label{def:intSet}
%We define the set of all internal objects as
%$$\I \equiv\ \{x\ |\ \internal{x} \}$$
%\end{definition}
%\begin{definition}[Subset]
%\label{def:subset}
%We define the subset relation in \Chainmail as
%$$S_1\ \subseteq\ S_2\ \equiv\ \forall x.[x\ \in\ S_1\ \longrightarrow\ x\ \in\ S_2]$$
%\end{definition}
%
%
%We note in Lemma \ref{lem:setModSet} that any set is a 
%subset of it's modifying set, in Lemma \ref{lem:modSetInternal} that 
%any modifying set of an internal set, is itself an internal set, 
%in Lemma \ref{lem:modInt} that the modifying set of \I is \I,
%and in Lemma \ref{lem:subsetTrans} that the subset relation is transitive.
%\begin{lemma}[Set $\subseteq$ Modifying Set]
%\label{lem:setModSet}
%For all modules $M$ and $M'$, program configurations $\sigma$, and object sets $S$, 
%if $M;\ M,\ \sigma\ \vDash S\ \subseteq\ X_S$
%\end{lemma}
%\begin{lemma}[Internal Modifying Set]
%\label{lem:modSetInternal}
%For all modules $M$ and $M'$, program configurations $\sigma$, and object sets $S$, 
%if $M;\ M,\ \sigma\ \vDash S\ \subseteq\ \I\ \longrightarrow X_S\ \subseteq\ \I$
%\end{lemma}
%\begin{lemma}[\I = $X_{\I}$]
%\label{lem:modInt}
%For all modules $M$ and $M'$, and program configurations $\sigma$, 
%$M;\ M,\ \sigma\ \vDash \I = X_{\I}$
%\end{lemma}
%\begin{lemma}[$\subseteq$ Transitivity]
%\label{lem:subsetTrans}
%For all modules $M$ and $M'$, program configurations $\sigma$, and object sets $S_1$, $S_2$, 
%and $S_3$, if $M;\ M,\ \sigma\ \vDash S_1\ \subseteq\ S_2\ \wedge\ S_2\ \subseteq\ S_3\ \longrightarrow\ S_1\ \subseteq\ S_3$
%\end{lemma}
%
%Finally, for simplicity, we introduce some notation for encapsulation by the 
%internal set in Def. \ref{def:intEncap}
%\begin{definition}[Internal Encapsulation]
%\label{def:intEncap}
%$$\encapsulated{S}\ \equiv\ \encapsulates{\I}{S}$$
%$$\encapsulated{x}\ \equiv\ \encapsulates{\I}{x}$$
%$$\encapsulated{x.f}\ \equiv\ \encapsulates{\I}{x.f}$$
%$$\bencapsulated{A}\ \equiv\ \bencapsulates{\I}{A}$$
%\end{definition}


%% Acknowledgments
\begin{acks}                            %% acks environment is optional
                                        %% contents suppressed with 'anonymous'
  %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
  %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
  %% acknowledge financial support and will be used by metadata
  %% extraction tools.
  This material is based upon work supported by the
  \grantsponsor{GS100000001}{National Science
    Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
  No.~\grantnum{GS100000001}{nnnnnnn} and Grant
  No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
  conclusions or recommendations expressed in this material are those
  of the author and do not necessarily reflect the views of the
  National Science Foundation.
\end{acks}


%% Bibliography
\bibliography{Case,more}

\clearpage

%% Appendix
\appendix
\appendix
\input{loo}

\section{Encapsulation}
\input{encapsulation}
\input{appendix-expressive}
\section{More \Nec Logic rules}
\label{a:necSpec}
\input{appendix-necessityspecs}
\input{appendix-assertLogic}
\input{appendix-BankAccount}

\end{document}
